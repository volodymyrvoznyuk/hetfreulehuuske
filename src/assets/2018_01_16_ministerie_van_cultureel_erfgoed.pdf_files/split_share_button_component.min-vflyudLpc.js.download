define(["require","exports","tslib","classnames","external/lodash","react","react-redux","dig-components/menu","spectrum/button","dig-components/buttons","spectrum/tooltip","modules/clean/cloud_docs/constants","modules/clean/filepath","modules/clean/integrations/data/selectors","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/education/types","modules/clean/react/app_actions/redirect","modules/clean/react/app_actions/telemetry_client","modules/clean/react/css","modules/clean/react/extensions/common","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/store","modules/clean/react/extensions/data/types","modules/clean/react/extensions/extensions_mini_directory_modal","modules/clean/react/extensions/extensions_utils","modules/clean/react/extensions/file","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/static_urls","modules/clean/user_education/react/user_education_effect","modules/constants/file_viewer","modules/core/i18n"],(function(e,t,n,o,i,r,a,s,l,p,c,u,d,g,h,_,f,m,S,v,A,O,E,T,I,y,P,b,x,C,N,L,w,B,M,k,F,D,U,H){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importStar(r);var R="TOOLTIP_ONLY"===U.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,V="COPY_ONLY"===U.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,G="COPY_AND_TOOLTIP"===U.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES;I.getStore();var q=function(e){var t=e.openOption,n=e.description;return r.default.createElement(s.Menu.ActionItem,{value:t,withLeftAccessory:t.iconUrl&&r.default.createElement("img",{alt:"",src:t.iconUrl,width:24,height:24}),withSubtitle:n},t.text)},Y=(function(t){function a(a){var d=t.call(this,a)||this;return d.handleClickShare=function(e){e.preventDefault(),d.props.onShowShare(),d.props.logShareButtonClick&&d.props.logShareButtonClick(),d.currentSession&&d.currentSession.event("click_share",{trigger_type:d.props.triggerType}),e.stopPropagation()},d.handleSelectAction=function(e){e.handler(),d.props.logShareButtonClick&&d.props.logShareButtonClick(e.userAction),v.logEvent(d.currentSession,"select_action",{type:e.type,trigger_type:d.props.triggerType})},d.handlePreventMouseDown=function(e){e.preventDefault(),d.state.tooltipState===_.TooltipState.BIG_ONBOARDING_TOOLTIP&&(d.markSplitShareTooltipViewed(),d.setState({tooltipState:_.TooltipState.NO_TOOLTIP})),e.stopPropagation()},d.handlePopoverHover=function(){d.currentSession&&d.currentSession.event("popover_trigger_hover",{trigger_type:d.props.triggerType})},d.handleShareHover=function(){d.currentSession&&d.currentSession.event("share_hover",{trigger_type:d.props.triggerType})},d.handlePopoverToggle=function(e){var t=e.isOpen,n=d.props,o=n.onDropdownOpen,i=n.onDropdownClose,r=n.triggerType,a=n.isCollapsed;if(t&&o?o():!t&&i&&i(),d.currentSession&&d.currentSession.event(t?"open_popover":"close_popover",{trigger_type:r}),t){var s=a?L.EventType.SidebarCollapsedShareClicked:L.EventType.SidebarOpenedShareClicked;w.filePreviewEventEmitter.emit(s,B.FilePreviewSession.currentSession)}},d.handlePresentInZoom=function(e,t){var n=d.props,o=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,r=n.onPresentInZoom,a=n.landingPageEnabled;i&&o&&r&&A.presentInZoomFlow(e,i,o,r,"split_share_button",a,t)},d.handleShareInSlack=function(e,t,n){var o=d.props,i=o.refreshSharingServiceInfo,r=o.sharingServiceInfo,a=o.landingPageEnabled;r&&i&&A.shareInSlackFlow(t,r,i,e,"split_share_button",a,n)},d.handleShareToTrello=function(e,t,n){var o=d.props,i=o.refreshSharingServiceInfo,r=o.sharingServiceInfo,a=o.landingPageEnabled;r&&i&&A.shareInTrelloFlow(t,r,i,e,"split_share_button",a,n)},d.handleUploadToCanvas=function(e,t,n){var o=d.props,i=o.refreshSharingServiceInfo,r=o.sharingServiceInfo,a=o.landingPageEnabled;r&&i&&A.shareInCanvasFlow(t,r,i,e,"split_share_button",a,n)},d.handleUpdateLinkState=function(e,t){(0,d.props.updateLinkState)({actionId:e,linkState:t})},d.handleAppAction=function(e,t,n){var o=d.props,i=o.context,r=o.featureFlags;f.redirectToActionOrShowAuth(t,e,n,r,i,d.handleUpdateLinkState,d.handleShareAction),v.logEvent(d.currentSession,"select_action",v.getAppActionExtras(n))},d.handleShareAction=function(e,t,n){var o=n.handler.service_type[".tag"],i={".tag":"profile_linked"},r=function(){d.handleUpdateLinkState(n.id,i),f.authorizeNoRedirect(e,n.id)};switch(o){case"slack_dropbox":return d.handleShareInSlack(t,e,r);case"zoom":return d.handlePresentInZoom(e,r);case"trello":return d.handleShareToTrello(t,e,r);case"canvas":return d.handleUploadToCanvas(t,e,r)}},d.getAppActionIconUrl=function(e){var t=e.icon;return t&&t.url&&!t.is_static?t.url:F.static_url("/static/images/generic_app_icon-vflIPYT1H.png")},d.getAppActionOpenOptionActions=function(e){var t=e.handler;if("profile_service"!==t[".tag"])return{type:M.OpenButtonAction.APP_ACTION,userAction:L.UserAction.ShareToAction};switch(t.service_type[".tag"]){case"slack_dropbox":return{type:M.OpenButtonAction.SHARE_TO_SLACK,userAction:L.UserAction.ShareToSlack};case"zoom":return{type:M.OpenButtonAction.PRESENT_IN_ZOOM,userAction:L.UserAction.PresentInZoom};case"trello":return{type:M.OpenButtonAction.SHARE_TO_TRELLO,userAction:L.UserAction.ShareToTrello};default:return{type:M.OpenButtonAction.APP_ACTION,userAction:L.UserAction.ShareToAction}}},d.handleHellosignDeepIntegrationLaunch=function(t,o){return new Promise((function(t,n){e(["modules/clean/integrations/hellosign_deep_integration/launcher"],t,n)})).then(n.__importStar).then((function(e){var n=(0,e.getLauncher)();return n.init({entryPoint:"share_menu",file:t,user:o}),n})).then((function(e){return e.launch(),e}))},d.getHellosignOpenOption=function(e,t){return{handler:function(){return d.handleHellosignDeepIntegrationLaunch(e,t)},iconUrl:F.static_url("/static/images/integrations/hellosign/signature-vflBGJCuJ.svg"),spriteName:null,text:H.intl.formatMessage({id:"KPapIP",defaultMessage:"Send for signature"}),type:M.OpenButtonAction.PREPARE_FOR_SIGNATURE,userAction:L.UserAction.ShareToAction}},d.getAppActionOpenOption=function(e,t,n){var o=d.getAppActionOpenOptionActions(n),i=o.type,r=o.userAction;return{handler:function(){d.handleAppAction(e,t,n)},spriteName:null,text:n.description,type:i,userAction:r,iconUrl:d.getAppActionIconUrl(n)}},d.getMoreAppsOpenOption=function(e,t){return{handler:function(){d.handleMoreApps(e,t),v.logEvent(d.currentSession,"select_show_more",{})},text:H.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}),type:M.OpenButtonAction.OPEN_MORE_APPS,userAction:L.UserAction.OpenMoreApps,spriteName:null}},d.getAddAppsOpenOption=function(e,t){return{handler:function(){d.handleMoreApps(e,t),v.logEvent(d.currentSession,"select_add_apps",{})},text:H.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}),type:M.OpenButtonAction.OPEN_ADD_APPS,userAction:L.UserAction.OpenAddApps,spriteName:null,iconUrl:F.static_url("/static/images/extensions/circled_plus-vfl7N2-Lg.svg")}},d.handleMoreApps=function(e,t){var n=d.props,o=n.appActions,i=n.featureFlags,r=n.context,a=n.categoryInfo,s=b.getCategoryIdToInfos(a);P.showExtensionsMiniDirectoryModal(H.intl.formatMessage({id:"A7cFjC",defaultMessage:"Share with these apps"}),t,e,o.sort(E.actionCompareFn),s,i,d.handleUpdateLinkState,r,d.currentSession,d.handleShareAction)},d.getShareWithEmailOpenOption=function(){return{handler:d.props.onShowShare,spriteName:null,text:H.intl.formatMessage({id:"8U/qbn",defaultMessage:"Share with Dropbox"}),type:M.OpenButtonAction.INVITE_VIA_EMAIL,userAction:L.UserAction.InviteViaEmail,iconUrl:F.static_url("/static/images/extensions/shared_medium-vfldEW5Iw.svg")}},d.getPopoverTriggerRenderer=function(e,t,i){return function(a){var s=V||G?r.default.createElement("img",{alt:"",src:F.static_url("/static/images/extensions/shared_light-vfl8nVEY_.svg")}):r.default.createElement(k.ButtonIcon,{isPrimary:"primary"===d.getButtonVariant(),name:"share","aria-label":i}),u=n.__assign({className:o.default("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":e}),tabIndex:t?void 0:-1,onMouseEnter:d.handlePopoverHover,"aria-label":H.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"})},a),g=e?s:"â–¾",h=d.props.useDigButtons?r.default.createElement(p.Button,n.__assign({},u,{variant:"primary"===d.props.variant?"primary":"opacity"}),g):r.default.createElement(l.Button,n.__assign({},u,{variant:d.getButtonVariant()}),g);return(R||G)&&e?r.default.createElement(c.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:H.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"})},h):h}},d.getPopoverItemRenderer=function(){return function(){var e=d.props,t=e.user,o=e.file,a=e.appActions,l=e.nonHellosignAppActions,p=e.featureFlags,c=p.expSplitShareBtn,g=p.hellosignDeepIntegration,h=e.isSendForSignatureEnabled,_=d.getShareWithEmailOpenOption(),f="DEEP_INTEGRATION"===g,m=u.isHellosignFileByExtension(x.getFileExt(n.__assign(n.__assign({},o),{bytes:0}))),S=null,v=a;if(f&&m&&h){v=l;var A=d.getHellosignOpenOption(o,t);S=r.default.createElement(q,{openOption:A})}var O="ON_SHOW_INVITE"===c?r.default.createElement(q,{openOption:_}):null,T=O||S?r.default.createElement(s.Menu.Segment,null,O,S):null,I=E.partitionActions(v),y=I.installedActions,P=I.unpromotedActions,b=i.isEmpty(y)?null:y.map((function(e){var n=d.getAppActionOpenOption(o,t,e);return r.default.createElement(q,{key:n.text,openOption:n})})),C=i.isEmpty(P)?null:r.default.createElement(q,{openOption:i.isEmpty(y)?d.getAddAppsOpenOption(o,t):d.getMoreAppsOpenOption(o,t)});return r.default.createElement(r.Fragment,null,T,r.default.createElement(s.Menu.Segment,null,b,C))}},d.markSplitShareTooltipViewed=function(){h.markTooltipViewed(d.props.user.id,"split_share_edu")},d.state={tooltipState:_.TooltipState.NO_TOOLTIP},d.telemetryClient=m.createTelemetryClient(n.__assign({component:"split-share-btn"},a.context)),d}return n.__extends(a,t),a.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},a.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,h.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=C.allowedTooltips(this.props.appActions.length>0,this.props.file.fq_path?"."+d.file_extension(d.filename(this.props.file.fq_path)):"",this.props.featureFlags),"split_share_edu"===t.find((function(t){return void 0!==e[t]&&!e[t]}))&&this.setState({tooltipState:_.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}}))}))},a.prototype.getButtonVariant=function(){var e=this.props,t=e.isVisible,n=e.variant;return n&&t?n:"invisible"},a.prototype.render=function(){var e=this.props,t=e.file,a=e.context,c=e.isVisible,g=e.shareButtonLabel,h=e.triggerType,_=e.isCollapsed,f=e.shouldUsePortalPopover,S=e.appActions,v=e.featureFlags,A=e.useDigButtons,O="ON_SHOW_INVITE"===(null==v?void 0:v.expSplitShareBtn)||!i.isEmpty(S);a?this.currentSession=this.telemetryClient.session({ext:m.getPiiSafeExtension(t?"."+d.file_extension(d.filename(t.fq_path)):"")}):delete this.currentSession;var E={"aria-label":g,className:o.default("extensions-split-share__share-button",{"primary-action-menu__button":h===y.TriggerType.SidebarPrimaryButton,"extensions-inline-share-button":O&&!A,"action-share":!O}),onClick:this.handleClickShare,tabIndex:c?void 0:-1,onMouseEnter:this.handleShareHover},T=r.default.createElement(D.UserEducationEffect,{containerName:"SplitShareButton",name:"ShareButtonLabel",useSpan:!0},g),I=A?r.default.createElement(p.Button,n.__assign({},E,{variant:"primary"===this.props.variant?"primary":"opacity"}),T):r.default.createElement(l.Button,n.__assign({},E,{variant:this.getButtonVariant()}),T),P=this.getPopoverTriggerRenderer(_,c,g),b=this.getPopoverItemRenderer(),C=this.props.sharingServiceInfo&&N.isSlackAvailable(this.props.sharingServiceInfo)&&N.isZoomAvailable(this.props.sharingServiceInfo),L="DEEP_INTEGRATION"===v.hellosignDeepIntegration&&u.isHellosignFileByExtension(x.getFileExt(n.__assign(n.__assign({},t),{bytes:0}))),w=r.default.createElement(s.Menu.Wrapper,{className:o.default("extensions-split-share__popover",{"hellosign-available-dropdown":L,"extensions-split-share__unportaled-menu":!f}),onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onToggle:this.handlePopoverToggle,closeOnSelection:!0,isPortaled:f},(function(e){var t=e.getContentProps,o=e.getTriggerProps;return r.default.createElement(r.default.Fragment,null,P(o()),r.default.createElement(s.Menu.Content,n.__assign({placement:"bottom-end"},t()),b()))}));return r.default.createElement("div",{className:o.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!c,"slack-zoom-available":C&&!_,"slack-zoom-available-collapsed":C&&_,"hellosign-available":L,"share-fake-split-button":O&&A})},_?null:I,O?w:null)},a.defaultProps={isVisible:!0,shareButtonLabel:H.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),triggerType:y.TriggerType.PrimaryButton,variant:"secondary"},a})(r.default.Component);t.SplitShareButtonComponent=Y;var Z={refreshSharingServiceInfo:O.refreshSharingServiceInfoAdapter,updateLinkState:O.updateLinkState},z=a.connect((function(e,t){return{appActions:T.getShareActionsForFile(e,n.__assign(n.__assign({},t.file),{bytes:0})),nonHellosignAppActions:T.getNonHellosignActionsForFile(e,n.__assign(n.__assign({},t.file),{bytes:0}),L.HELLOSIGN_PROD_APP_ID),categoryInfo:T.getCategoryInfos(e),featureFlags:T.getFeatureFlags(e),sharingServiceInfo:T.getSharingServiceInfoAdapter(e),landingPageEnabled:g.isConnectServiceLandingPagesEnabled(e),isSendForSignatureEnabled:g.isSendForSignatureEnabled(e)}}),Z)(Y);t.SplitShareButton=S.requireCssWithComponent(z,["/static/css/extensions/index-vflbYwcKR.css","/static/css/app_actions/index-vflM3ESn8.css"])}));
//# sourceMappingURL=split_share_button_component.min.js-vflVew2z7.map