define("modules/clean/search/logger",["require","exports","tslib","modules/clean/analytics","modules/clean/search/api_helpers","modules/clean/react/browse/logger_util"],(function(e,t,r,s,a,o){"use strict";var n;function i(e,t){var s=e;return r.__assign(r.__assign({},t),{file_nsid:s.ns_id,file_sjid:s.sjid,match_type:s.match_type||void 0})}Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.SHARED_DOC="shared_doc",e.SHARED_CLOUD_DOC="shared_cloud_doc"})(n=t.SearchLogResultType||(t.SearchLogResultType={})),t.logSearchAction=function(e){var t=e.searchSessionId,i=e.result,c=e.user,l=e.action_type,u=e.search_type,p=e.viewport,h=void 0===p?"full-view":p,d=e.view_type,_=e.action_surface,m=a.getCurrentTimezoneOffset(),f={viewport:h,action_type:l,search_type:u,search_session_id:t,view_type:d,position:i.sort_rank,request_id:i.request_id,timezone_offset:m};if(o.isFile(i)){var g=i;f=r.__assign(r.__assign({},f),{file_nsid:g.ns_id,file_sjid:g.sjid,match_type:g.match_type})}else if(o.isPaper(i)){var S=i;f=r.__assign(r.__assign({},f),{paper_pad_id:S.pad_id})}else if(o.isPaperFolder(i)){var y=i;f=r.__assign(r.__assign({},f),{paper_folder_id:y.folder_id})}else{var E=(g=i).is_cloud_doc?n.SHARED_CLOUD_DOC:n.SHARED_DOC;f=r.__assign(r.__assign({},f),{match_type:g.match_type,file_id:g.file_id,extra:{result_type:E}})}_&&(f.extra=r.__assign(r.__assign({},f.extra),{action_surface:_})),s.SearchClientActivityLogger.log("result_action",c.id,f)},t.logRecentHistoryDisplayed=function(e){var t=e.searchSessionId,r=e.user,o=e.history,n=a.getCurrentTimezoneOffset(),i=o.map((function(e){return e.rawQuery})).reduce((function(e,t,r){return e[r]=t,e}),{}),c={search_session_id:t,recent_history_map:JSON.stringify(i),timezone_offset:n,viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_displayed",r.id,c)},t.logRecentHistoryCleared=function(e){var t=e.searchSessionId,r=e.user,o={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset(),viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_cleared",r.id,o)},t.logRecentQuerySelected=function(e){var t=e.searchSessionId,r=e.query,o=e.user,n=e.rank,i=e.action_type,c=a.getCurrentTimezoneOffset(),l={search_session_id:t,query_string:r.rawQuery,position:n,timezone_offset:c,viewport:"dropdown-view",action_type:i};s.SearchClientActivityLogger.log("recent_query_selected",o.id,l)},t.logRecentQueryStored=function(e){var t=e.searchSessionId,r=e.requestId,o=e.query,n=e.user,i=e.previousPosition,c=e.viewport,l=void 0===c?"dropdown-view":c,u=a.getCurrentTimezoneOffset(),p={search_session_id:t,request_id:r,query_string:o.rawQuery,position:i,timezone_offset:u,viewport:l};s.SearchClientActivityLogger.log("recent_query_stored",n.id,p)},t.logScopeChipChanged=function(e){var t=e.searchSessionId,r=e.user,o=e.chipAdded,n=e.filePath,i=e.searchType,c=e.viewport,l={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset(),path_scoped:o,file_path:n,viewport:c,search_type:i};s.SearchClientActivityLogger.log("scope_chip_changed",r.id,l)},t.logSearchBarFocusLost=function(e){var t=e.searchSessionId,r=e.user,o={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset()};s.SearchClientActivityLogger.log("search_bar_focus_lost",r.id,o)},t.logHoverPreviewStarted=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l};s.SearchClientActivityLogger.log("preview_started",o.id,i(r,u))},t.logHoverPreviewCompleted=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u=e.latency,p=e.displayed,h={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l,latency:u,displayed:p?"true":"false"};s.SearchClientActivityLogger.log("preview_completed",o.id,i(r,h))},t.logHoverPreviewFailed=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u=e.failureType,p={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l,failure_type:u};s.SearchClientActivityLogger.log("preview_failed",o.id,i(r,p))},t.logSearchResultsSortOrderChange=function(e){var t=e.searchSessionId,r=e.user,a=e.action_type,o=e.search_type,n=e.sort_order,i=e.viewport,c={viewport:void 0===i?"full-view":i,action_type:a,search_type:o,search_session_id:t,view_type:e.view_type,extra:{sort_field:n.sortField,sort_direction:n.sortDirection}};s.SearchClientActivityLogger.log("sort_results",r.id,c)}})),define("modules/clean/search/search_bar/api",["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/search/constants","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),o=r.__importStar(o),n=r.__importStar(n);var f=(function(e){function t(t){var r=this,s=this.constructor.prototype;return(r=e.call(this,t)||this).__proto__=s,r}return r.__extends(t,e),t})(Error);t.RequestAbortedError=f;var g=(function(){function e(){this._searchApiUrl="/search/dropdown_search",this._activeRequest=null}return e.prototype.getSearchApiUrl=function(){return this._searchApiUrl},e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype._extractSlimSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var a=s[r];switch(a.search_result_type){case l.SearchResultTypes.FILE:t.push(u.SlimFileSearchResult.fromServerObject(a));break;case l.SearchResultTypes.PAPER:t.push(c.Paper.fromServerObject(a));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(c.PaperFolder.fromServerObject(a))}}return t},e.prototype.loadSlimResults=function(e){var t=e.user,s=e.path,a=e.query,o=e.searchSessionId,n=e.webTimer,i=e.fileCategories,c=p.getCurrentTimezoneOffset(),l=i?h.fileCategoriesToString(i):"",u=r.__assign({query:a,fq_path:s,timezone_offset:c,search_session_id:o,include_shared_docs:!0},l&&{file_categories:l});return this._fetchSlimResults(u,t,o,n)},e.prototype.fetchAdditionalFileMetadata=function(e){var t=this,r=e.searchResults,a=e.user;return new Promise((function(e,o){var i=r.filter((function(e){return e instanceof u.SlimFileSearchResult})).map((function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]}));i.length>0?s.WebRequest({url:n.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(i),includes:JSON.stringify([n.HREF])},dataType:"json",subject_user:a,success:function(s,a,o){var n=s.file_results;e(t._mergeFullResultsIntoSlimResults(n,r))},error:function(e,t,r){o("abort"===r?new f:new Error(r))}}):e(r)}))},e.prototype.fetchFullSearchResult=function(e){var t=e.searchResult,r=e.user,s=e.onSuccess,a=e.onError;if(t instanceof u.SlimFileSearchResult){var o=d.searchResultForPath(_.getStoreForSearchBar().getState(),t.fq_path);o?s(o):this.fetchAdditionalFileMetadata({searchResults:[t],user:r}).then((function(e){if(e.length>0)s(e[0]);else if(a){var t=m.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."});a(t)}})).catch((function(e){!a||e instanceof f||a(e.message)}))}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s(t)},e.prototype._mergeFullResultsIntoSlimResults=function(e,t){for(var s=[],a=function(t){if(t instanceof u.SlimFileSearchResult){var a=e.find((function(e){return e.search_result_type===l.SearchResultTypes.FILE&&o.paths_are_equal(e.fq_path,t.fq_path)}));a&&s.push(c.File.fromServerObject(r.__assign(r.__assign({},t),a)))}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s.push(t)},n=0,i=t;n<i.length;n++){a(i[n])}return s},e.prototype._fetchSlimResults=function(e,t,r,a){var o=this;return new Promise((function(n,c){var l;null!=o._activeRequest&&o._activeRequest.abort();var p=h.fileCategoryStringToLogValue(e.file_categories),d={path_scoped:"/"!==e.fq_path,search_type:"dropdown",query_string:e.query,search_session_id:r,timezone_offset:e.timezone_offset,file_type_filters:p};i.SearchClientActivityLogger.log("query_started",t.id,d);var _=(new Date).getTime();o._activeRequest=s.WebRequest({url:o._searchApiUrl,data:e,dataType:"json",subject_user:t,success:function(s,c,l){for(var p=u.extractBrowseContext(s),h=s.search_results,m=l.getResponseHeader("x-dropbox-request-id"),f=0,g=0,S=h;g<S.length;g++){var y=S[g];y.request_id=m,y.sort_rank||0===y.sort_rank||(y.sort_rank=f++)}var E={results:o._extractSlimSearchResultsList(h),hasMore:!!s.more,nextPageOffset:+s.next_offset||0},v=i.SearchClientActivityLogger.create_search_log_dict(d,m,_,e.query,E.results.length,null,r);i.SearchClientActivityLogger.log("query_completed",t.id,v),a&&a.end(m||void 0),n({context:p,searchResults:E,deleted:!1})},error:function(s,o,n){l=s.getResponseHeader("x-dropbox-request-id");var u=i.SearchClientActivityLogger.create_search_log_dict(d,l,_,e.query,null,o,r);i.SearchClientActivityLogger.log("query_failed",t.id,u),a&&a.abort(),c("abort"===n?new f:new Error(n))},complete:function(){this._activeRequest=null}})}))},e})();t.SearchBarApiClient=g,t.searchBarApiClient=new g,t.getQuerySuggestions=function(e,t,r,s){return(new a.UserApiV2Client).ns("files").rpc("get_query_suggestions",{query:t,max_results:r,search_session_id:s,variants:"search_experiment_query_suggestions:POSTERIOR_ONLY_WITH_3_SUGGESTIONS"},{subjectUserId:e})}})),define("modules/clean/search/search_bar/controller",["require","exports","tslib","react","react-redux","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/retrieval_success_banner/util","modules/clean/search/logger","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/log_helper","modules/clean/search/search_bar/view","modules/clean/search/search_helpers","modules/clean/search/search_bar/chips","modules/clean/storage","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/core/notify","modules/clean/search/types","modules/clean/react/css","modules/core/browser"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,g,S,y,E,v,R,C,b,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),l=r.__importStar(l),p=r.__importStar(p),h=r.__importStar(h),f=r.__importStar(f),g=r.__importStar(g),E=r.__importStar(E),w=r.__importStar(w);var P=(function(e){function t(t){var s=e.call(this,t)||this;return s._searchBarWebTimer=null,s._logHistoryItemSelected=function(e,t,r){l.logRecentQuerySelected({searchSessionId:s.props.searchSessionId,query:e,user:s.props.user,rank:t-s.props.headerItems.length,action_type:r})},s._handleHistoryItemClick=function(e,t){s._logHistoryItemSelected(e,t),s._setSearchQuery(e.rawQuery)},s._handleRecentSearchContextMenuCapture=function(e,t){s._logHistoryItemSelected(e,t,v.WebUserActionLogEvent.CONTEXT_MENU)},s._handleInputChange=function(e){s._setSearchQuery(e)},s._handleCancelSearch=function(){s._setSearchQuery("")},s._handleScopeChipChange=function(e){l.logScopeChipChanged({searchSessionId:s.props.searchSessionId,user:s.props.user,chipAdded:e,searchType:"dropdown",filePath:e?s.props.browseScope:"/",viewport:s.props.isExpanded?"full-view":void 0}),e?s.props.setScopeChip({scopeChip:s.props.browseScope}):s.props.setScopeChip({}),s._setSearchQuery(s.props.rawQuery,!0)},s._onBrowseScopeChange=function(e){s.props.setScopeChip({scopeChip:g.isValidPathForChip(e)?e:void 0})},s._handleInputKeydown=function(e,t){e.keyCode!==o.KeyCode.ESC?e.keyCode!==o.KeyCode.BACKSPACE||0!==t||g.isScopeChipRoot(s.props.scopeChip)?(e.stopPropagation(),e.keyCode===o.KeyCode.UP?(e.preventDefault(),s.props.highlightPreviousRow()):e.keyCode===o.KeyCode.DOWN&&(e.preventDefault(),s.props.highlightNextRow())):s._handleScopeChipChange(!1):s._handleCancelSearch()},s._handleSearch=function(e,t){s.props.searchBarExperiments.expSearchSuccessBanner&&c.doSearchBarInteractionBroadcast(!1);var a=f.fileCategoriesToString(s.props.fileCategories);s.props.onSearch({query:e,searchToken:f.getSearchCsrfToken(),searchSessionId:s.props.searchSessionId,searchPath:t||s.props.scopeChip,qargs:r.__assign(r.__assign({},a&&{file_categories:a}),{search_order_by:i.getQueryArgs().search_order_by,search_reverse_order:i.getQueryArgs().search_reverse_order,search_type:i.getQueryArgs().search_type})})},s._navToSelection=function(e){var t=s.props.searchResults[e],r=s.props.slimSearchResults[e];t?(s._handleSlimSearchResultOpen(r),s._openSearchResult(t)):r&&s._handleSearchResultOpen(r)},s._handleInputSubmit=function(e,t){e.preventDefault();var r=s.props.headerItems;if(t<r.length)switch(r[t]){case C.SearchBarDropdownHeaderItemType.SEARCH_ALL:s._handleSearch(s.props.normalizedQuery);break;case C.SearchBarDropdownHeaderItemType.SCOPE_CHIPS:var a=!g.isValidPathForChip(s.props.scopeChip);s._handleScopeChipChange(a)}else t-=r.length,s._navToSelection(t)},s._handleContextMenuCapture=function(e){var t=s.props,r=t.user,a=t.searchSessionId;u.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._dispatchSearchSuccessful(e.request_id||""),_.logDropdownSearchAction({result:e,user:r,action_type:e instanceof n.File?v.WebUserActionLogEvent.CONTEXT_MENU:v.WebUserActionLogEvent.PAPER_CONTEXT_MENU,viewport:"dropdown-view",searchSessionId:a})}})},s._handleSlimSearchResultOpen=function(e){var t=s.props,r=t.onSlimSearchResultOpen,a=t.searchBarExperiments.expSearchSuccessBanner;r&&(a&&"/h"===w.get_pathname()&&c.setSearchSuccessBannerVisibleFromHome(),r(e))},s._handleSearchResultOpen=function(e){var t=s.props,r=t.user;if(t.searchBarExperiments.expSearchSuccessBanner&&e&&e.fq_path&&(c.doSearchBarInteractionBroadcast(!1),c.doSearchResultActionClickBroadcast(!1),c.setSearchSuccessBannerVisible(),e.is_dir)){var a=e.fq_path;c.setFolderSearchResultData(a)}s._handleSlimSearchResultOpen(e),u.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._openSearchResult(e)},onError:function(e){R.Notify.error(e)}})},s._handleResultObjectPathClick=function(e){s._dispatchSearchSuccessful(e.request_id||""),s.props.onResultObjectPathClick(e)},s._handleHighlightDropdownItem=function(e){s.props.setHighlightedRow({highlightedSearchRow:e})},s._handleSearchBarFocus=function(){var e=s.props,t=e.user,r=e.searchBarExperiments;s._setSearchQuery(s.props.normalizedQuery),r.expSearchSuccessBanner&&(c.resetSearchResultClickKey(),c.doSearchBarInteractionBroadcast(!1)),s.props.focusSearchBar(),s.props.loadHistory({user:t})},s._handleSearchBarBlur=function(){var e=s.props,t=e.searchBarExperiments,r=e.searchBarLoading,a=e.slimSearchResults;!t.expSearchSuccessBanner||c.userIsOptedOutOfRetrievalSuccessBanner()||c.shouldShowSearchSuccessBanner()||r||!a.length||c.setSearchSuccessBannerVisible(),s.props.blurSearchBar()},s._dispatchSearchSuccessful=function(e){var t=s.props,r=t.user,a=t.rawQuery,o=t.normalizedQuery,n=t.searchSessionId;(0,t.addQueryToHistory)({user:r,query:{rawQuery:a,normalizedQuery:o},searchSessionId:n,requestId:e})},s._logSearchBarTTI=function(){s._searchBarWebTimer&&s._searchBarWebTimer.markTimeToInteractive()},s._handleHistoryClearAllClick=function(){var e=s.props,t=e.user;(0,e.clearAllHistory)({user:t})},t.setExperiments({experiments:t.searchBarExperiments}),s.props.setScopeChip({scopeChip:t.currentPath}),s}return r.__extends(t,e),t.prototype.componentWillMount=function(){var e=y.Viewer.get_viewer().get_users().map((function(e){return e.id}));S.UserLocalStorage.clearOtherUsers(e)},t.prototype.componentWillUnmount=function(){this._logFocusLost(this.props.isFocused,!1)},t.prototype.componentWillReceiveProps=function(e){this.props.currentPath!==e.currentPath&&this._onBrowseScopeChange(e.currentPath||t.defaultProps.currentPath),this.props.searchBarExperiments!==e.searchBarExperiments&&this.props.setExperiments({experiments:e.searchBarExperiments})},t.prototype.componentDidUpdate=function(e){this._logFocusLost(e.isFocused,this.props.isFocused),this.props.currentPath===e.currentPath&&f.fileCategoriesToString(this.props.fileCategories)===f.fileCategoriesToString(e.fileCategories)||this.props.invalidateResults()},t.prototype._logFocusLost=function(e,t){e&&!t&&l.logSearchBarFocusLost({user:this.props.user,searchSessionId:this.props.searchSessionId})},t.prototype._setSearchQuery=function(e,t){void 0===t&&(t=!1);var r=this.props,s=r.user;(0,r.setSearchQueryAndFetchResults)({user:s,query:e,webTimer:this._startSearchBarTimer(),keepHighlightedRow:t})},t.prototype._openSearchResult=function(e){this._dispatchSearchSuccessful(e.request_id||""),this.props.onSearchResultOpen(e)},t.prototype._startSearchBarTimer=function(){return this._searchBarWebTimer?this._searchBarWebTimer.restart():(this._searchBarWebTimer=E.get_timer("search_bar"),this._searchBarWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:u.searchBarApiClient.getSearchApiUrl()})),this._searchBarWebTimer},t.prototype.render=function(){var e=this.props,t=e.user,r=e.isExpanded,a=e.isFocused,o=e.isActive,n=e.rawQuery,i=e.normalizedQuery,c=e.slimSearchResults,l=e.searchBarLoading,u=e.searchSessionId,p=e.highlightedRow,h=e.searchHistory,d=e.scopeChip,_=e.searchPath,f=e.headerItems,g=e.searchBarExperiments,S=e.browseScope,y=e.placeholder;return s.default.createElement(m.SearchBarView,{user:t,isExpanded:!!r,searchBarExperiments:g,isFocused:a,isActive:o,inputTextValue:n,normalizedQuery:i,searchResults:c,searchBarLoading:l,searchSessionId:u,highlightedRow:p,searchHistory:h,scopeChip:d,browseScope:S,searchPath:_,dropdownHeaderItems:f,placeholder:y,onSearch:this._handleSearch,onHistoryClearAllClick:this._handleHistoryClearAllClick,onHistoryItemClick:this._handleHistoryItemClick,onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchResultOpen:this._handleSearchResultOpen,onContextMenuCapture:this._handleContextMenuCapture,onRecentSearchContextMenuCapture:this._handleRecentSearchContextMenuCapture,onResultObjectPathClick:this._handleResultObjectPathClick,onSearchBarFocus:this._handleSearchBarFocus,onSearchBarBlur:this._handleSearchBarBlur,onHighlightDropdownItem:this._handleHighlightDropdownItem,onSearchChipInteraction:this._handleScopeChipChange,onDropdownTTI:this._logSearchBarTTI})},t.defaultProps={currentPath:"/",isExpanded:!1},t})(s.default.PureComponent);t.SearchBarControllerElement=P;var I=d.getStoreForSearchBar(),T={blurSearchBar:p.blurSearchBar,focusSearchBar:p.focusSearchBar,loadHistory:p.loadHistory,highlightPreviousRow:p.highlightPreviousRow,highlightNextRow:p.highlightNextRow,setHighlightedRow:p.setHighlightedRow,addQueryToHistory:p.addQueryToHistory,setSearchQueryAndFetchResults:p.setSearchQueryAndFetchResults,clearAllHistory:p.clearAllHistory,setExperiments:p.setExperiments,setScopeChip:p.setScopeChip,invalidateResults:p.invalidateResults},A=a.connect((function(e){var t=h.isSearchBarFocused,r=h.isSearchBarActive,s=h.rawQuery,a=h.normalizedQuery,o=h.searchResults,n=h.slimSearchResults,i=h.isSearchBarLoading,c=h.searchSessionId,l=h.highlightedSearchRow,u=h.searchHistory,p=h.scopeChip,d=h.searchPath,_=h.headerItems,m=h.browseScope,f=h.fileCategories,g=h.resultsInvalid;return{isFocused:t(e),isActive:r(e),rawQuery:s(e),normalizedQuery:a(e),searchResults:o(e),slimSearchResults:n(e),searchBarLoading:i(e),searchSessionId:c(e),highlightedRow:l(e),searchHistory:u(e),scopeChip:p(e),searchPath:d(e),headerItems:_(e),browseScope:m(e),fileCategories:f(e),resultsInvalid:g(e)}}),T)(P);t.SearchBarController=b.requireCssWithComponent((function(e){return s.default.createElement(a.Provider,{store:I},s.default.createElement(A,r.__assign({},e)))}),["/static/css/search/search_bar_react-vfl_tKL9-.css"])})),define("modules/clean/search/search_bar/data/action_creators",["require","exports","tslib","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/types","modules/clean/search/search_bar/history","modules/core/exception"],(function(e,t,r,s,a,o,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),n=r.__importStar(n),i=r.__importStar(i),t.focusSearchBar=function(){return{type:o.ActionTypes.FOCUS}},t.blurSearchBar=function(){return{type:o.ActionTypes.BLUR}},t.clearSearchBar=function(){return{type:o.ActionTypes.CLEAR}},t.updateHistoryInternal=function(e){var t=e.searchHistory;return{type:o.ActionTypes.UPDATE_HISTORY,payload:{searchHistory:t}}},t.loadHistory=function(e){var r=e.user;return function(e){var s=n.getHistory(r);e(t.updateHistoryInternal({searchHistory:s}))}},t.addQueryToHistory=function(e){var r=e.user,s=e.query,a=e.searchSessionId,o=e.requestId,i=e.skipLogging;return function(e){var c=n.addQuery(r,s,a,o,i);e(t.updateHistoryInternal({searchHistory:c}))}},t.clearAllHistory=function(e){var r=e.user,s=e.skipLogging;return function(e,o){var i=n.clearAll(r,a.searchSessionId(o()),s);e(t.updateHistoryInternal({searchHistory:i}))}},t.setSearchQuery=function(e){var t=e.query,r=e.searchSessionId,s=e.keepHighlightedRow,a=e.searchPath;return{type:o.ActionTypes.SET_QUERY,payload:{query:t,searchSessionId:r,keepHighlightedRow:s,searchPath:a}}},t.setSearchResults=function(e){var t=e.searchResults;return{type:o.ActionTypes.SET_SEARCH_RESULTS,payload:{searchResults:t}}},t.setSlimSearchResults=function(e){var t=e.slimSearchResults;return{type:o.ActionTypes.SET_SLIM_SEARCH_RESULTS,payload:{slimSearchResults:t}}},t.setHighlightedRow=function(e){var t=e.highlightedSearchRow;return{type:o.ActionTypes.SET_HIGHLIGHTED_ROW,payload:{highlightedSearchRow:t}}},t.highlightPreviousRow=function(){return{type:o.ActionTypes.HIGHLIGHT_PREVIOUS_ROW}},t.highlightNextRow=function(){return{type:o.ActionTypes.HIGHLIGHT_NEXT_ROW}},t.setBrowseScope=function(e){var t=e.browseScope;return{type:o.ActionTypes.SET_BROWSE_SCOPE,payload:{browseScope:t}}},t.setScopeChip=function(e){var t=e.scopeChip;return{type:o.ActionTypes.SET_SCOPE_CHIP,payload:{scopeChip:t}}},t.setFileCategories=function(e){var t=e.fileCategories;return{type:o.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:t}}},t.invalidateResults=function(){return{type:o.ActionTypes.INVALIDATE_RESULTS}},t.setSearchQueryAndFetchResults=function(o){var n=this,c=o.user,l=o.query,u=o.webTimer,p=o.searchSessionId,h=o.keepHighlightedRow;return function(o,d){return r.__awaiter(n,void 0,void 0,(function(){var n,_,m,f,g,S;return r.__generator(this,(function(y){switch(y.label){case 0:if(n=a.scopeChip(d()),(_=function(){return l===a.rawQuery(d())&&n===a.searchPath(d())})()&&!a.resultsInvalid(d()))return[2];if(o(t.setSearchQuery({query:l,searchPath:n,searchSessionId:p,keepHighlightedRow:h})),!a.isSearchBarLoading(d()))return[3,9];y.label=1;case 1:return y.trys.push([1,8,,9]),[4,s.searchBarApiClient.loadSlimResults({user:c,path:n,query:a.normalizedQuery(d()),searchSessionId:a.searchSessionId(d()),webTimer:u,fileCategories:a.fileCategories(d())})];case 2:if(m=y.sent().searchResults,!_())return[2];y.label=3;case 3:return y.trys.push([3,5,,6]),[4,new Promise((function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)})).then(r.__importStar)];case 4:return(0,y.sent().checkForMissingStarredData)({items:m.results,user:c}),[3,6];case 5:return f=y.sent(),i.reportException({err:f,severity:i.SEVERITY.NONCRITICAL,tags:["search_bar"]}),[3,6];case 6:return o(t.setSlimSearchResults({slimSearchResults:m})),[4,s.searchBarApiClient.fetchAdditionalFileMetadata({searchResults:m.results,user:c})];case 7:return g=y.sent(),_()?(o(t.setSearchResults({searchResults:{results:g,hasMore:!1}})),[3,9]):[2];case 8:if(!((S=y.sent())instanceof s.RequestAbortedError))throw S;return[3,9];case 9:return[2]}}))}))}},t.setExperiments=function(e){var t=e.experiments;return{type:o.ActionTypes.SET_EXPERIMENTS,payload:{experiments:t}}}})),define("modules/clean/search/search_bar/experiments",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInSearchSuccessBannerExperiment=function(e){return e&&!!e.expSearchSuccessBanner},t.getNumOfQuerySuggestionsToFetch=function(){return 3}})),define("modules/clean/search/search_bar/history",["require","exports","tslib","external/lodash","modules/clean/search/constants","modules/clean/storage","modules/clean/search/logger"],(function(e,t,r,s,a,o,n){"use strict";function i(e){return o.UserLocalStorage.get(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[]}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n),t.getHistory=i;var c=function(e,t){return e.normalizedQuery===t.normalizedQuery};function l(e,t){return s.findIndex(e,(function(e){return c(e,t)}))}t.addQuery=function(e,t,s,u,p){void 0===s&&(s=""),void 0===u&&(u=""),void 0===p&&(p=!1);var h=i(e);if(!t.normalizedQuery.length)return h;if(!p){var d=l(h,t);n.logRecentQueryStored({searchSessionId:s,requestId:u,query:t,user:e,previousPosition:d})}return h=h.filter((function(e){return!c(e,t)})),h=r.__spreadArrays([t],h).slice(0,a.SEARCH_RECENT_HISTORY_CAPACITY),o.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,h),h},t.clearAll=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r=!1),r||n.logRecentHistoryCleared({searchSessionId:t,user:e});var s=[];return o.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,s),s},t.getPreviousPosition=l,t.testMockSetup=function(){o.UserLocalStorage.clearOtherUsers([])},t.testMockTeardown=function(){o.UserLocalStorage.clearOtherUsers([])}})),define("modules/clean/search/search_bar/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors"],(function(e,t,r,s,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),o=r.__importStar(o),t.logDropdownSearchAction=function(e){var t=e.result,r=e.user,n=e.action_type,i=e.viewport,c=e.view_type,l=e.searchSessionId;s.logSearchAction({searchSessionId:l||o.searchSessionId(a.getStoreForSearchBar().getState()),result:t,user:r,action_type:n,search_type:"dropdown",viewport:i,view_type:c})}})),define("modules/clean/search/search_bar/view",["require","exports","tslib","classnames","react","spectrum/icon_content","spectrum/icon_global","modules/clean/em_string","modules/clean/filepath","modules/clean/keycode","modules/clean/react/title_bubble","modules/clean/search/search_bar/chips","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/i18n","modules/clean/react/sticky_position"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),c=r.__importStar(c),p=r.__importStar(p),d=r.__importStar(d);var f=(function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderDropdown=function(){},e._handleNavigation=function(){e._searchBarInput.blurSearchBarTextInput()},e._onHistoryItemClick=function(t,r){e.props.onHistoryItemClick&&e.props.onHistoryItemClick(t,r)},e._onSearchResultOpen=function(t){e.props.onSearchResultOpen(t),e._handleNavigation()},e._onResultObjectPathClick=function(t){e.props.onResultObjectPathClick(t),e._handleNavigation()},e._onSearch=function(t){var r=e.props.onSearch;r&&r(t),e._handleNavigation()},e._setSearchBarInputRef=function(t){return e._searchBarInput=t},e._setSearchBarDropdownRef=function(t){e._searchBarDropdown=t},e}return r.__extends(o,t),o.prototype.getSearchBarInput=function(){return this._searchBarInput},o.prototype.getSearchBarDropdown=function(){return this._searchBarDropdown},o.prototype._shouldRenderDropdown=function(){var e=this.props,t=e.searchHistory,r=e.normalizedQuery,s=e.dropdownHeaderItems;return!!(t&&t.length||s&&-1!==s.indexOf(h.SearchBarDropdownHeaderItemType.SCOPE_CHIPS)||r&&r.length)},o.prototype.componentDidMount=function(){var t=this;d.waitForTTI().then((function(){Promise.all([new Promise((function(t,r){e(["modules/clean/search/search_bar/dropdown"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)})).then(r.__importStar)]).then((function(e){var r=e[0].SearchBarDropdown,s=e[1];s.Star,s.HOME_RESOURCE_ID_TYPE,s.StarredSource,s.checkForMissingStarredData;t._renderDropdown=function(){var e=t.props,s=e.browseScope,o=e.children,n=e.dropdownHeaderItems,i=e.highlightedRow,c=e.isFocused,l=e.normalizedQuery,u=e.onContextMenuCapture,p=e.onDropdownTTI,h=e.onHighlightDropdownItem,d=e.onHistoryClearAllClick,_=e.onRecentSearchContextMenuCapture,m=e.onSearchChipInteraction,f=e.scopeChip,g=e.searchBarExperiments,S=e.searchBarLoading,y=e.searchHistory,E=e.searchPath,v=e.searchSessionId,R=e.showLinkToResultsPage,C=e.searchResults,b=e.user;return a.default.createElement(r,{browseScope:s,children:o,dropdownHeaderItems:n||[],highlightedRow:i,isOpen:c,normalizedQuery:l,onContextMenuCapture:u,onDropdownTTI:p,onHighlightDropdownItem:h,onHistoryClearAllClick:d,onHistoryItemClick:t._onHistoryItemClick,onRecentSearchContextMenuCapture:_,onResultObjectPathClick:t._onResultObjectPathClick,onSearch:t._onSearch,onSearchChipInteraction:m,onSearchResultOpen:t._onSearchResultOpen,ref:t._setSearchBarDropdownRef,scopeChip:f,searchBarExperiments:g,searchBarLoading:S,searchHistory:y||[],searchPath:E,searchSessionId:v,showLinkToResultsPage:R,searchResults:C,user:b})},t._shouldRenderDropdown()&&t.forceUpdate()}))}))},o.prototype.render=function(){var e=this.props,t=e.isActive,o=e.isExpanded,n=e.isFocused,i={"search-bar--container":!0,"u-l-fr":!0,"is-expanded":o,"is-focused":n},c={"is-active":t,"is-collapsed":!(o||n),"is-expanded":o,"is-focused":n,"search-bar":!0},l=this._shouldRenderDropdown();return a.default.createElement("div",{className:s.default(i)},a.default.createElement("div",{className:s.default(c)},a.default.createElement(g,r.__assign({},this.props,{shouldRenderDropdown:l,ref:this._setSearchBarInputRef})),l&&this._renderDropdown()))},o.defaultProps={inputTextValue:"",normalizedQuery:"",showLinkToResultsPage:!0},o})(a.default.Component);t.SearchBarView=f;var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.focusSearchBarTextInput=function(){t.props.isFocused||t._searchBarTextInput.focus()},t._onKeyDown=function(e){var r=t.props,s=r.normalizedQuery,a=r.areQuerySuggestionsLoaded,o=s&&a;e.keyCode!==l.KeyCode.ESC||o||t.blurSearchBarTextInput(),t.props.onInputKeydown(e,t._getCursorPosition())},t._onSubmit=function(e){var r=t.props.highlightedRow,s=t.props.searchHistory||[],a=!t.props.normalizedQuery&&s.length>0,o=t.props.dropdownHeaderItems||[],n=r-o.length;if(a&&n>=0){e.preventDefault();var i=s[n];t.props.onHistoryItemClick&&t.props.onHistoryItemClick(i,n)}else{var c=t.props,l=c.normalizedQuery,u=c.areQuerySuggestionsLoaded,p=c.querySuggestions,d=c.onQuerySuggestionsClick,_=c.onQuerySuggestionsDismiss,m=r-1;if(!(l&&u&&p&&d&&_))return r<o.length&&o[r]===h.SearchBarDropdownHeaderItemType.SCOPE_CHIPS||t.blurSearchBarTextInput(),t.props.onInputSubmit(e,r);e.preventDefault(),m>=0?d(p[m],m):_(i=l||"")}},t._handleInputChange=function(e){t.props.onInputChange(e.currentTarget.value)},t._setSearchBarTextInputRef=function(e){return t._searchBarTextInput=e},t}return r.__extends(t,e),t.prototype._getCursorPosition=function(){return this._searchBarTextInput.selectionEnd},t.prototype.getSearchBarTextInput=function(){return this._searchBarTextInput},t.prototype.blurSearchBarTextInput=function(){this._searchBarTextInput.blur(),this.props.onSearchBarBlur()},t.prototype.render=function(){var e=this.props,t=e.onSearchBarFocus,s=e.onSearchBarBlur,o=e.isFocused,i=e.highlightedRow,c=e.inputTextValue,l=e.shouldRenderDropdown?{"aria-expanded":o,"aria-activedescendant":"search-dropdown-item"+i,"aria-autocomplete":"list","aria-owns":"search-bar__dropdown-items",role:"combobox"}:void 0,u=this.props.placeholder||_.intl.formatMessage({id:"vOBkFB",defaultMessage:"Search"});return a.default.createElement("form",{className:"search-bar__input",onSubmit:this._onSubmit},a.default.createElement("span",{"aria-label":u,className:"search-bar__button","aria-hidden":"true"},a.default.createElement(n.IconGlobal,{name:"search-small"})),a.default.createElement(S,r.__assign({},this.props,{focusSearchInput:this.focusSearchBarTextInput})),a.default.createElement("input",r.__assign({"aria-label":u},l,{className:"search-bar__text-input",maxLength:1e3,onChange:this._handleInputChange,onFocus:t,onBlur:s,onKeyDown:this._onKeyDown,placeholder:u,ref:this._setSearchBarTextInputRef,value:c})))},t})(a.default.Component);t.SearchBarInput=g;var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onScopeChipClosed=function(){t.props.onSearchChipInteraction&&t.props.onSearchChipInteraction(!1)},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.scopeChip,r=e.user,s=e.isFocused,n=e.isExpanded;if(t&&p.isValidPathForChip(t)){var i=r.cdm_tmf_path&&t&&c.paths_are_equal(r.cdm_tmf_path,t)?"folder_team_member_child-small":"folder-small",l=c.child_dir(t);return a.default.createElement(y,{key:"scope",isFocused:s,isExpanded:n,icon:a.default.createElement(o.IconContent,{name:i,height:"18px",width:"18px"}),text:l,onClose:this._onScopeChipClosed,onClick:this.props.focusSearchInput})}return null},t})(a.default.Component),y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseDownOnChipItem=function(e){e.stopPropagation(),e.preventDefault()},t._onMouseDownClose=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClose()},t._onMouseDownOnChipButton=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClick()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.isFocused,r=e.isExpanded,s=e.text,o=e.icon;if(!s)return null;var n=i.Emstring.em_snippet(s,8,.6),c=a.default.createElement("span",{className:"search_bar__chip_text",key:"text"},n),l=n!==s;return r||t?a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("span",{className:"search_bar__chip_item",tabIndex:0,onMouseDown:this._onMouseDownOnChipItem,"data-chip":s},o,l?a.default.createElement(u.TitleBubble,{content:s,position:m.StickyPosition.BOTTOM,key:"text"},c):c),a.default.createElement("button",{type:"button","aria-label":_.intl.formatMessage({id:"l/akBu",defaultMessage:"Remove filter"}),className:"search_bar__chip_close_button",key:"close",onMouseDown:this._onMouseDownClose})):a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("button",{type:"button","aria-label":_.intl.formatMessage({id:"vOBkFB",defaultMessage:"Search"}),className:"search_bar__chip_button",onMouseDown:this._onMouseDownOnChipButton},o))},t})(a.default.PureComponent)})),define("modules/clean/search/single_page/constants",["require","exports","modules/clean/search/types","modules/core/i18n"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEARCH_QUERY_DEBOUNCE=50,t.SEARCH_FIRST_PAGE_SIZE=10,t.SEARCH_MIN_PAGE_SIZE=t.SEARCH_FIRST_PAGE_SIZE,t.SEARCH_DROPDOWN_PAGE_SIZE=8,t.SEARCH_ADDITIONAL_PAGE_SIZE=50,t.SEARCH_SECOND_PAGE_DEBOUNCE=200,t.SEARCH_URL_ROOT="/search",t.SEARCH_URL_REGEX=/^\/search\//,t.BROWSE_URL_REGEX=/^\/(home|personal|work)/,t.HOME_URL_REGEX=/^\/h([^\w]|$)/,t.SEARCH_HISTORY_DELAY=500,t.SEARCH_WEB_TIMER="single-page-search",t.SEARCH_TAB_HEIGHT=40,t.SEARCH_SUCCESS_BANNER_HEIGHT=70,t.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY=3,t.FILE_CATEGORIES_PAPER=[{category:r.FileCategory.IMAGE,label:s.intl.formatMessage({id:"ZnS57e",defaultMessage:"Images"}),tooltip:s.intl.formatMessage({id:"AZvTRu",defaultMessage:"JPG, PNG, GIF, and more"}),icon:"image-small"},{category:r.FileCategory.DOCUMENT,label:s.intl.formatMessage({id:"EYw1Cy",defaultMessage:"Documents"}),tooltip:s.intl.formatMessage({id:"PFhg9W",defaultMessage:"DOC, DOCX, TXT, and more"}),icon:"txt-small"},{category:r.FileCategory.PDF,label:s.intl.formatMessage({id:"lKbROR",defaultMessage:"PDFs"}),tooltip:s.intl.formatMessage({id:"s39/fs",defaultMessage:"PDF"}),icon:"pdf-small"},{category:r.FileCategory.SPREADSHEET,label:s.intl.formatMessage({id:"GRyN3w",defaultMessage:"Spreadsheets"}),tooltip:s.intl.formatMessage({id:"IrhSVL",defaultMessage:"XLSX, XLS, CSV, and more"}),icon:"numbers-small"},{category:r.FileCategory.PRESENTATION,label:s.intl.formatMessage({id:"noyhQI",defaultMessage:"Presentations"}),tooltip:s.intl.formatMessage({id:"cHykwm",defaultMessage:"PPT, PPTX, KEY, and more"}),icon:"keynote-small"},{category:r.FileCategory.AUDIO,label:s.intl.formatMessage({id:"UYx/2r",defaultMessage:"Audio"}),tooltip:s.intl.formatMessage({id:"qT1l41",defaultMessage:"MP3, WAV, MID, and more"}),icon:"audio-small"},{category:r.FileCategory.VIDEO,label:s.intl.formatMessage({id:"AF+/tL",defaultMessage:"Video"}),tooltip:s.intl.formatMessage({id:"ZXY9/v",defaultMessage:"MOV, WMV, MP4, and more"}),icon:"video-small"},{category:r.FileCategory.FOLDER,label:s.intl.formatMessage({id:"U6qGE8",defaultMessage:"Folders"}),tooltip:s.intl.formatMessage({id:"rJEV8X",defaultMessage:"Dropbox folders"}),icon:"folder-small"},{category:r.FileCategory.PAPER,label:s.intl.formatMessage({id:"+rsEJ/",defaultMessage:"Paper docs"}),tooltip:s.intl.formatMessage({id:"iYnBgp",defaultMessage:"Dropbox Paper docs"}),icon:"paper-small"},{category:r.FileCategory.OTHER,label:s.intl.formatMessage({id:"MYByNv",defaultMessage:"Other"}),tooltip:s.intl.formatMessage({id:"tS6aDQ",defaultMessage:"Other file types"}),icon:"unknown-small"}],t.FILE_CATEGORIES_NO_PAPER=t.FILE_CATEGORIES_PAPER.filter((function(e){return e.category!==r.FileCategory.PAPER}))})),define("modules/clean/search/single_page/input/wrapper",["require","exports","tslib","react-redux","react","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/react/css","modules/clean/react/retrieval_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/single_page/input/component","modules/clean/search/single_page/navigation","modules/clean/web_timing_logger","modules/clean/web_user_action_events"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),n=r.__importStar(n);var _=new o.UserApiV2Client,m=(function(t){function o(o){var n=t.call(this,o)||this;return n.loadConnectedInput=function(){return r.__awaiter(n,void 0,void 0,(function(){var t,o,n,i,u,h,m,f,g,S,y,E,v,R,C,b,w,P,I,T,A,x,O,M,B,H,L,F,D=this;return r.__generator(this,(function(N){switch(N.label){case 0:return[4,Promise.all([new Promise((function(t,r){e(["modules/clean/search/single_page/input/connected"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/input/suggestions"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/selectors/experiments"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/selectors/index"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/utils"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/logger"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/dropdown"],t,r)})).then(r.__importStar),_.ns("search").rpc("get_experiment_data",void 0,{subjectUserId:this.props.user.id})])];case 1:return t=N.sent(),o=t[0].ConnectedSearchInput,n=t[1].ConnectedSearchSuggestions,i=t[2].getStoreForSearch,u=t[3],h=u.clear,m=u.setVariant,f=u.setQuery,g=u.setUser,S=u.setPath,y=u.updateFromUrl,E=u.setExperiments,v=u.setSessionId,R=u.fetchPeopleSuggestions,C=t[4].searchBarExperiments,b=t[5].sessionId,w=t[6],P=w.generateRandomId,I=w.navigateToResult,T=t[7],A=T.logSearchBoxFocus,x=T.logNavigateToResult,O=t[8].SearchDropdown,M=t[9],B=M.user_options,H=M.experiments,(L=i()).dispatch(m({variant:this.props.variant})),L.dispatch(g({user:this.props.user,options:B})),void 0!==this.props.path&&L.dispatch(S({path:this.props.path})),L.dispatch(E({experiments:H})),L.dispatch(R({user:this.props.user,query:""})),"full-page"===this.props.variant&&(p.searchNavigationManager.removeListener("update",this.handleUrlUpdate),p.searchNavigationManager.removeListener("exit",this.handleUrlExit),p.searchNavigationManager.addListener("update",(function(e){e.query&&!D.props.isActive&&D.props.onSearchEnter&&D.props.onSearchEnter(),L.dispatch(y(e))})),p.searchNavigationManager.addListener("exit",(function(){l.isInSearchSuccessBannerExperiment(C(L.getState()))&&c.setSearchSuccessBannerVisible(),D.props.onSearchExit&&D.props.onSearchExit(),L.dispatch(h())})),p.searchNavigationManager.load()),b(L.getState())||L.dispatch(v({sessionId:P()})),this.state.query&&L.dispatch(f({query:this.state.query})),this.handleSearchEnter=function(){A(),D.props.onSearchEnter&&D.props.onSearchEnter()},F=function(e,t,r){I(e,t,r),x(r,e,d.ActionSurfaceLogValue.TOP_NAVIGATION,d.ActionSourceValue.KEYBOARD)},this.renderInput=function(){return a.createElement(s.Provider,{store:L},a.createElement(a.Fragment,null,a.createElement(o,r.__assign({},D.props,{autoFocus:D.state.hasFocus,onInputBlur:D.handleInputBlur,onSearchEnter:D.handleSearchEnter,navigateToResult:F})),a.createElement(n,{onFocusInput:D.handleFocusInput}),"dropdown"===D.props.variant&&a.createElement(O,{inputBox:D.props.inputBoxRef})))},[2]}}))}))},n.handleInputBlur=function(){n.setState({hasFocus:!1})},n.handleFocusInput=function(){n.setState({hasFocus:!0})},n.handleUrlUpdate=function(e){e.query&&(n.props.isActive||n.handleSearchEnter(),n.handleSetQuery({query:e.query}))},n.handleUrlExit=function(){n.handleSearchExit()},n.handleSearchEnter=function(){n.setState({hasFocus:!0}),n.props.onSearchEnter&&n.props.onSearchEnter()},n.handleSearchExit=function(){n.handleSetQuery({query:""}),n.props.onSearchExit&&n.props.onSearchExit()},n.handleSetQuery=function(e){var t=e.query;n.setState({query:t}),h.get_timer("single_page_search").restart()},n.handleSetPath=function(e){var t=e.path;n.setState({path:t})},n.handleClear=function(){n.setState({query:"",path:""})},n.state={hasReduxStoreLoaded:!1,hasFocus:!1,query:"",path:o.path||"",querySuggestions:void 0,highlightedRow:-1,filteredContact:void 0,peopleSuggestions:void 0},n}return r.__extends(o,t),o.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return"full-page"===this.props.variant&&(p.searchNavigationManager.init(this.props.user),p.searchNavigationManager.addListener("update",this.handleUrlUpdate),p.searchNavigationManager.addListener("exit",this.handleUrlExit),p.searchNavigationManager.load()),0===document.location.pathname.indexOf("/search")?[3,2]:[4,h.waitForTTI()];case 1:e.sent(),e.label=2;case 2:return[4,this.loadConnectedInput()];case 3:return e.sent(),this.setState({hasReduxStoreLoaded:!0}),[2]}}))}))},o.prototype.UNSAFE_componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(o){switch(o.label){case 0:return!this.state.hasReduxStoreLoaded||this.props.isActive||n.paths_are_equal(t.path,this.props.path)||void 0===t.path?[3,3]:[4,new Promise((function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)})).then(r.__importStar)];case 1:return s=o.sent().getStoreForSearch,[4,new Promise((function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)})).then(r.__importStar)];case 2:a=o.sent().setPath,s().dispatch(a({path:t.path,viewport:"input"})),o.label=3;case 3:return[2]}}))}))},o.prototype.render=function(){return this.state.hasReduxStoreLoaded?this.renderInput():a.createElement(u.SearchInputComponent,r.__assign({},this.props,this.state,{setQuery:this.handleSetQuery,setPath:this.handleSetPath,clear:this.handleClear,onSearchEnter:this.handleSearchEnter,onSearchExit:this.handleSearchExit}))},o})(a.Component);t.SearchInput=i.requireCssWithComponent(m,["/static/css/search/input-vflbU_AzO.css","/static/js/retrieval-components/index.web-vfl2Ysp1K.css"])})),define("modules/clean/search/single_page/input/component",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/text_fields","modules/clean/filepath","modules/clean/keycode","modules/clean/react/async/loadable","modules/clean/react/no-jquery","modules/clean/react/retrieval_success_banner/util","modules/clean/search/single_page/navigation","modules/clean/search/store_helpers","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,g,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),l=r.__importStar(l),g=r.__importStar(g);var y=p.Loadable({loader:function(){return f.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/search/single_page/input/chips"],t,r)})).then(r.__importStar).then((function(e){return e.SearchChips}))}))},loading:a.createElement("span",{className:"search-chips"})}),E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hiddenButton=a.createRef(),t.hasEmptyQuery=function(){return!m.normalize(t.props.query)},t.handleChange=function(e){t.props.setQuery({query:e.target.value})},t.handleFocus=function(){t.props.onSearchEnter(),t.props.expSearchSuccessBanner&&d.resetSearchResultClickKey()},t.handleBlur=function(){t.hasSuggestions()||t.props.onInputBlur&&t.props.onInputBlur()},t.hasSuggestions=function(){return t.hasQuerySuggestions()||t.hasPeopleSuggestions()},t.hasQuerySuggestions=function(){return t.props.query.length>0&&t.props.querySuggestions&&t.props.querySuggestions.length},t.hasPeopleSuggestions=function(){return t.props.query.length>0&&t.props.peopleSuggestions&&t.props.peopleSuggestions.length},t.getNumOfSuggestions=function(){return t.getNumOfQuerySuggestions()+t.getNumOfPeopleSuggestions()},t.getNumOfQuerySuggestions=function(){return t.hasQuerySuggestions()?t.props.querySuggestions.length:0},t.getNumOfPeopleSuggestions=function(){return t.hasPeopleSuggestions()?t.props.peopleSuggestions.length:0},t.dismissSuggestions=function(){t.dimsissQuerySuggestions(),t.dismissPeopleSuggestions()},t.dimsissQuerySuggestions=function(){t.hasQuerySuggestions()&&t.props.dismissQuerySuggestions&&t.props.setHighlightedRow&&(t.props.dismissQuerySuggestions({query:t.props.query}),t.props.setHighlightedRow({index:void 0}))},t.dismissPeopleSuggestions=function(){t.hasPeopleSuggestions()&&t.props.dismissPeopleSuggestions&&t.props.dismissPeopleSuggestions({query:t.props.query})},t.onExitButtonClick=function(){t.handleSearchExit()},t.handleSearchExit=function(e){void 0===e&&(e=!0),t.props.expSearchSuccessBanner&&!d.userIsOptedOutOfRetrievalSuccessBanner()&&d.setSearchSuccessBannerVisible(),_.searchNavigationManager.exit(),t.props.onSearchExit(),t.input&&e&&t.input.blur(),t.hiddenButton.current&&e&&t.hiddenButton.current.focus()},t.handleEscape=function(){t.hasSuggestions()?t.dismissSuggestions():t.hasEmptyQuery()?t.handleSearchExit():(t.props.clear(),t.input&&t.input.focus())},t.handleKeyArrowDown=function(e){if(t.props.setHighlightedRow)if(e.preventDefault(),t.hasSuggestions()){var r=void 0===t.props.highlightedRow?0:Math.min(t.props.highlightedRow+1,t.getNumOfSuggestions()-1);t.props.setHighlightedRow({index:r})}else if(t.props.results&&!t.props.results.isEmpty()){r=void 0===t.props.highlightedRow?0:Math.min(t.props.highlightedRow+1,t.props.results.count());t.props.setHighlightedRow({index:r})}},t.handleKeyArrowUp=function(e){if(t.props.setHighlightedRow)if(e.preventDefault(),t.hasSuggestions()){var r=void 0===t.props.highlightedRow?t.getNumOfSuggestions()-1:Math.max(t.props.highlightedRow-1,0);t.props.setHighlightedRow({index:r})}else if(t.props.results&&!t.props.results.isEmpty()){r=void 0===t.props.highlightedRow?t.props.results.count()-1:Math.max(t.props.highlightedRow-1,0);t.props.setHighlightedRow({index:r})}},t.handleKeyEnter=function(e){if(t.props.highlightedRow&&e.preventDefault(),t.hasSuggestions()){if(t.dismissSuggestions(),void 0===t.props.highlightedRow)return;var r=t.getNumOfQuerySuggestions();if(t.props.highlightedRow<r){if(!(s=t.props.querySuggestions[t.props.highlightedRow]))return;t.props.setQuery({query:s.text,alwaysTriggerSearch:!0})}else{var s;if(!(s=t.props.peopleSuggestions[t.props.highlightedRow-r]))return;t.props.setFilteredAccountId({filteredAccountId:s.dbx_account_id}),t.props.setQuery({query:"",alwaysTriggerSearch:!0})}t.input&&t.input.focus()}else t.props.highlightedRow&&t.props.results&&!t.props.results.isEmpty()&&(0===t.props.highlightedRow?t.props.onSearch&&t.props.onSearch():t.props.results.has(t.props.highlightedRow-1)&&t.props.navigateToResult&&t.props.navigateToResult(t.props.results.get(t.props.highlightedRow-1),t.props.user,t.props.results))},t.handleKeyDown=function(e){switch(e.keyCode){case u.KeyCode.ESC:t.handleEscape();break;case u.KeyCode.DOWN:t.handleKeyArrowDown(e);break;case u.KeyCode.UP:t.handleKeyArrowUp(e);break;case u.KeyCode.ENTER:t.handleKeyEnter(e);break;case u.KeyCode.BACKSPACE:t.input&&0===t.input.selectionStart&&0===t.input.selectionEnd&&(t.props.filteredContact?t.props.setFilteredAccountId({filteredAccountId:void 0}):l.paths_are_equal(t.props.path,"/")||t.props.setPath({path:"/",viewport:"input"}));break;case u.KeyCode.TAB:e.shiftKey&&t.hasEmptyQuery()&&t.handleSearchExit(!1)}},t.handleSubmit=function(e){e.preventDefault(),t.props.onSearch&&t.props.onSearch()},t.handleDocumentClick=function(e){t.props.isActive&&e.srcElement&&(t.hasSuggestions()?h.closestElement(e.srcElement,".search__form")||t.dismissSuggestions():t.hasEmptyQuery()&&(h.closestElement(e.srcElement,".maestro-nav__container")||h.closestElement(e.srcElement,".pagelet-top-menu__container")||h.closestElement(e.srcElement,".maestro-header")&&!h.closestElement(e.srcElement,".search__form"))&&t.handleSearchExit())},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){document.addEventListener("click",this.handleDocumentClick,!1),this.props.autoFocus&&this.input&&(this.input.value="",this.input.focus(),this.input.value=this.props.query)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleDocumentClick,!1)},t.prototype.componentDidUpdate=function(e){var t=this;!this.props.isActive&&e.isActive&&this.input&&setTimeout((function(){return t.input.blur()}),5),this.props.autoFocus&&!e.autoFocus&&this.input&&this.input.focus()},Object.defineProperty(t.prototype,"input",{get:function(){return this.props.inputBoxRef&&this.props.inputBoxRef.current},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.isActive,r=e.query,u=e.filteredContact,p=e.path,h=u?S.intl.formatMessage({id:"BffPZc",defaultMessage:"Add search terms to improve your results"}):S.intl.formatMessage({id:"9+lBHX",defaultMessage:"Search"}),d=u?S.intl.formatMessage({id:"bSdTWj",defaultMessage:"Search for content from {name}"},{name:u.name}):p?S.intl.formatMessage({id:"cOMGEP",defaultMessage:"Search in folder {folder}"},{folder:l.filename(p)}):S.intl.formatMessage({id:"5RccSl",defaultMessage:"Search"});return a.createElement("div",{className:s.default({search__form:!0,"search__form--is-active":t}),role:"combobox","aria-expanded":t,"aria-haspopup":"listbox","aria-owns":"search__dropdown"},a.createElement("form",{onSubmit:this.handleSubmit,role:"search",key:"search__form"},a.createElement(c.TextInput.Container,{size:g.iOS?"large":"standard",className:"search__input-container"},a.createElement(c.TextInput.Accessory,null,a.createElement(n.UIIcon,{src:i.SearchLine})),a.createElement(y,{path:p,setPath:this.props.setPath,user:this.props.user,filteredContact:this.props.filteredContact,setFilteredAccountId:this.props.setFilteredAccountId}),a.createElement(c.TextInput.Input,{onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:h,value:r,className:s.default("search__input",{"search__input--ios":g.iOS}),ref:this.props.inputBoxRef,"aria-label":d}),t&&a.createElement(c.TextInput.Accessory,null,a.createElement(o.IconButton,{variant:"transparent",className:"search__exit-button",onClick:this.onExitButtonClick,type:"button",size:"small","aria-label":S.intl.formatMessage({id:"T7tcC/",defaultMessage:"Exit search"})},a.createElement(n.UIIcon,{src:i.CloseLine}))))))},t.defaultProps={onSearchEnter:function(){},onSearchExit:function(){}},t})(a.PureComponent);t.SearchInputComponent=E})),define("modules/clean/search/single_page/navigation",["require","exports","tslib","eventemitter3","modules/clean/browse_uri_interface","modules/clean/query_string_helpers","modules/clean/search/single_page/constants","modules/core/browser","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.DESKTOP_FROM_PATHS=["assistant","collab_browse"];var l=(function(e){function s(t,r){var s=e.call(this)||this;return s.lastHistoryMs=0,s.initialPath="",s.setSearchUrl=function(e,t){e!==s.document.location.pathname+s.document.location.search&&(s.returnTo||n.SEARCH_URL_REGEX.test(s.document.location.pathname)||(s.returnTo=s.document.location.pathname+s.document.location.search),t||s.shouldPushHistory()?s.window.history.pushState({},c.intl.formatMessage({id:"dcywUW",defaultMessage:"Search results - Dropbox"}),e):s.window.history.replaceState({},c.intl.formatMessage({id:"dcywUW",defaultMessage:"Search results - Dropbox"}),e),s.lastHistoryMs=(new Date).getTime(),s.previousTitle||(s.previousTitle=s.document.title,s.document.title=c.intl.formatMessage({id:"dcywUW",defaultMessage:"Search results - Dropbox"})))},s.setNonSearchUrl=function(e){s.shouldRedirect(e)?i.redirect(e):(s.window.history.pushState({},s.previousTitle||"",e),s.previousTitle&&(s.document.title=s.previousTitle,s.previousTitle=void 0),s.emit("exit"))},s.handlePopState=function(){n.SEARCH_URL_REGEX.test(s.document.location.pathname)?(s.lastHistoryMs=(new Date).getTime(),s.emit("update",o.parseQueryString(s.document.location.search))):s.shouldRedirect(s.document.location.pathname)?i.reload():s.emit("exit")},s.shouldPushHistory=function(){return(new Date).getTime()-s.lastHistoryMs>=n.SEARCH_HISTORY_DELAY},s.shouldRedirect=function(e){return(!n.HOME_URL_REGEX.test(s.initialPath)||!n.HOME_URL_REGEX.test(e))&&(!n.BROWSE_URL_REGEX.test(s.initialPath)||!n.BROWSE_URL_REGEX.test(e))},s.document=t,s.window=r,s}return r.__extends(s,e),Object.defineProperty(s.prototype,"source",{get:function(){return n.HOME_URL_REGEX.test(this.initialPath)?"home":n.BROWSE_URL_REGEX.test(this.initialPath)?"browse":n.SEARCH_URL_REGEX.test(this.initialPath)?"search":null},enumerable:!0,configurable:!0}),s.prototype.init=function(e){this.user=e,this.initialPath=this.document.location.pathname,this.window.addEventListener("popstate",this.handlePopState)},s.prototype.load=function(){if(n.SEARCH_URL_REGEX.test(this.document.location.pathname)){this.emit("update",o.parseQueryString(this.document.location.search));var e=o.parseQueryString(this.document.location.search);e.search_from&&!n.SEARCH_URL_REGEX.test(e.search_from)&&-1===t.DESKTOP_FROM_PATHS.indexOf(e.search_from)&&(this.returnTo=e.search_from)}},s.prototype.set=function(e,t){e&&(n.SEARCH_URL_REGEX.test(e)?this.setSearchUrl(e,t):this.setNonSearchUrl(e))},s.prototype.exit=function(){n.SEARCH_URL_REGEX.test(this.document.location.pathname)&&(this.returnTo&&!n.SEARCH_URL_REGEX.test(this.returnTo)||(this.returnTo=a.get_browse_root(this.user)),this.set(this.returnTo),this.returnTo=void 0)},s})(s.default);t.SearchNavigationManager=l,t.searchNavigationManager=new l(document,window)})),define("modules/clean/react/maestro/layout/header",["require","exports","tslib","classnames","react","react-dom","dig-components/typography","modules/clean/react/css","modules/clean/react/maestro/components/header_portal","modules/clean/react/maestro/layout/top_menu_container","modules/clean/react/maestro/responsive","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/user_education/react/user_education_effect"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),o=r.__importDefault(o);var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.useHeaderPortal,o=e.chromeClass,n=e.useMaestroPortal,i=r.__rest(e,["useHeaderPortal","chromeClass","useMaestroPortal"]);if("ON"===n)return a.default.createElement(a.default.Fragment,null,a.default.createElement(c.MaestroPortal,{maestroPortalExperiment:n,element:c.MaestroPortalElement.TITLE,chromeClass:o},a.default.createElement("div",{className:s.default("page-header__title",this.props.titleClass)},a.default.createElement(h.UserEducationEffect,{containerName:"PageletMaestroHeader",name:"Title",useSpan:!0},this.props.title))),a.default.createElement(c.MaestroPortal,{maestroPortalExperiment:n,element:c.MaestroPortalElement.SEARCH,chromeClass:o},a.default.createElement(l.TopMenuContainer,r.__assign({},i))));var p=a.default.createElement("header",{className:"maestro-header page-header__shadow"},a.default.createElement(u.VerticallyFixedWrapper,{className:"page-header",responsive:this.props.responsive},a.default.createElement("div",{className:s.default("page-header__title",this.props.titleClass)},a.default.createElement(h.UserEducationEffect,{containerName:"PageletMaestroHeader",name:"Title",useSpan:!0},this.props.title)),a.default.createElement(l.TopMenuContainer,r.__assign({},i))));return t?a.default.createElement(_,{chromeClass:o},p):p},t.defaultProps={isSearchBarExpanded:!1},t})(a.default.Component);t.PageletMaestroHeaderWithoutCSS=d;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.UNSAFE_componentWillMount=function(){if(this.portalEl=document.getElementById("maestro-header-portal"),!this.portalEl){var e=document.getElementById("pagelet-2");e&&(this.portalEl=document.createElement("div"),this.portalEl.setAttribute("id","maestro-header-portal"),e.parentNode.insertBefore(this.portalEl,e))}},t.prototype.render=function(){return this.portalEl?a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"maestro-header page-header__shadow"}),o.default.createPortal(a.default.createElement("div",{className:this.props.chromeClass},this.props.children),this.portalEl)):this.props.children},t})(a.default.Component);t.MaestroHeaderPortal=_;t.MaestroHeaderTitle=function(e){var t=e.children;return a.default.createElement(n.Title,{className:"page-header__heading",tagName:"h1"},t)};t.MaestroHeaderLogo=function(){return a.default.createElement("a",{href:"/",className:"page-header__logo"},a.default.createElement(p.DropboxLogo,{alt:"Dropbox"}))};var m=i.requireCssWithComponent(d,["/static/css/dig-components/index.web-vflyKkT3N.css","/static/css/maestro_layout-vflOKQW5k.css"]);t.PageletMaestroHeader=m})),define("modules/clean/react/maestro/layout/chrome",["require","exports","tslib","react","classnames","spectrum/match","modules/clean/react/maestro/layout/header","modules/clean/react/maestro/layout/secondary_sidebar","modules/clean/react/maestro/responsive","modules/clean/react/maestro/components/header_portal"],(function(e,t,r,s,a,o,n,i,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a);var u=(function(e){function t(t){var a=e.call(this,t)||this;a.scrollableSidebarRef=s.default.createRef(),a.isPageResponsive=function(){return!(!document||!document.documentElement)&&document.documentElement.classList.contains(c.RESPONSIVE_CLASS)},a.handleSetup=function(){a.setState({setupComplete:!0})},a.handleMatchMedium=function(){!1===a.state.responsive.isMatchedMedium&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedMedium:!0})}}))},a.handleUnmatchMedium=function(){!0===a.state.responsive.isMatchedMedium&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedMedium:!1})}}))},a.handleMatchLarge=function(){!1===a.state.responsive.isMatchedLarge&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedLarge:!0})}}))},a.handleUnmatchLarge=function(){!0===a.state.responsive.isMatchedLarge&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedLarge:!1})}}))};var o=a.isPageResponsive();return a.state={responsive:{isResponsive:o,isMatchedMedium:!o,isMatchedLarge:!o},setupComplete:!o},a}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,u=e.titleRegion,p=e.titleClass,h=e.chromeClass,d=e.embeddedAppRegion,_=e.actionSidebarRegion,m=e.searchBarProps,f=e.useHeaderPortal,g=e.scrollableSidebarRegion,S=e.useScrollableSidebar,y=e.useMaestroPortal,E=e.useSidebarV2,v=this.state,R=v.setupComplete,C=v.responsive,b=g&&S;return s.default.createElement("div",{className:a.default(["maestro-chrome",h])},C.isResponsive&&s.default.createElement(o.Match,{media:c.BREAKPOINT_LARGE,onSetup:this.handleSetup,onMatch:this.handleMatchLarge,onUnmatch:this.handleUnmatchLarge}),C.isResponsive&&s.default.createElement(o.Match,{media:c.BREAKPOINT_MEDIUM,onSetup:this.handleSetup,onMatch:this.handleMatchMedium,onUnmatch:this.handleUnmatchMedium}),R&&s.default.createElement(n.PageletMaestroHeader,r.__assign({user:t,title:u,titleClass:p,chromeClass:h,responsive:C,useHeaderPortal:f},m||{},{useMaestroPortal:y})),R&&s.default.createElement(l.MaestroPortal,{element:l.MaestroPortalElement.CONTENT,maestroPortalExperiment:y,chromeClass:a.default(["maestro-content-chrome",h])},s.default.createElement("div",{className:"maestro-app"},s.default.createElement("div",{className:"maestro-app-content"},"function"==typeof d?d(C):d),_&&!b&&s.default.createElement("div",{className:"maestro-secondary-sidebar__shadow",role:"complementary","aria-label":"sidebar"},s.default.createElement(i.MaestroSecondarySidebar,{responsive:C},"function"==typeof _?_(C):_)),g&&b&&(E?s.default.createElement("div",{className:"maestro-secondary-sidebar-v2"},"function"==typeof g?g(C,this.scrollableSidebarRef):g):s.default.createElement("div",{className:"maestro-secondary-sidebar__shadow",role:"complementary"},s.default.createElement("div",{className:"maestro-secondary-sidebar scrollable-secondary-sidebar",ref:this.scrollableSidebarRef},"function"==typeof g?g(C,this.scrollableSidebarRef):g))))))},t})(s.default.PureComponent);t.MaestroChrome=u})),define("modules/clean/react/maestro/responsive",["require","exports","tslib","react","spectrum/vertically_fixed"],(function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.RESPONSIVE_CLASS="maestro--responsive",t.BREAKPOINT_MEDIUM="(min-width: 736px)",t.BREAKPOINT_LARGE="(min-width: 1025px)";var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.responsive,o=r.__rest(e,["responsive"]),n=t&&t.isResponsive?"div":a.VerticallyFixed;return s.default.createElement(n,o)},t.displayName="VerticallyFixedWrapper",t})(s.default.Component);t.VerticallyFixedWrapper=o})),define("modules/clean/react/maestro/layout/secondary_sidebar",["require","exports","tslib","react","modules/clean/react/maestro/responsive"],(function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={},r}return r.__extends(t,e),t.prototype.render=function(){return s.default.createElement(a.VerticallyFixedWrapper,{responsive:this.props.responsive,className:"maestro-secondary-sidebar"},this.props.children)},t})((s=r.__importDefault(s)).default.Component);t.MaestroSecondarySidebar=o})),define("modules/clean/react/maestro/layout/top_menu_container",["require","exports","tslib","react","external/lodash","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/history","modules/clean/react/browse/models","modules/core/browser","modules/clean/search/search_bar/controller","modules/clean/search/search_bar/log_helper","modules/clean/search/search_helpers","modules/core/uri","modules/clean/web_user_action_events","modules/clean/search/constants","modules/clean/react/css","modules/clean/search/single_page/input/wrapper"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),n=r.__importStar(n),i=r.__importDefault(i),l=r.__importStar(l),h=r.__importStar(h);var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSearch=function(e){var s=e.query,a=e.searchToken,o=e.searchSessionId,n=e.searchPath,c=e.qargs,u=t.props.user;s&&l.redirect(h.buildSearchURL({user:u,searchPath:n,normalizedQuery:s,searchSessionId:o,searchToken:a,qargs:r.__assign(r.__assign({},c),{search_from:i.default.deconstruct_url().path})}).toString())},t.onSlimSearchResultOpen=function(e){var r=t.props.user;if(e instanceof c.Paper||e instanceof c.PaperFolder)l.open_tab(e.url);else{var s=e;if(s.is_dir){var a=new d.URI({path:"/"+r.role+s.fq_path});l.open_tab(a.toString())}else{var o=s.fq_path.substring(1);a=new d.URI({path:"/"+r.role}).updateQuery({preview:o});l.open_tab(a.toString())}}},t.logSearchResultOpen=function(e){var r=t.props.user;e instanceof c.File?p.logDropdownSearchAction({result:e,user:r,action_type:e.is_dir?_.WebUserActionLogEvent.FOLDER_OPEN:_.WebUserActionLogEvent.FILE_VIEW,viewport:"top-menu-dropdown-view"}):(e instanceof c.Paper||e instanceof c.PaperFolder)&&p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.PAPER_OPEN,viewport:"top-menu-dropdown-view"})},t.onResultObjectPathClick=function(e){var r=t.props.user;p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"});var s=n.parent_dir(e.fq_path),a=o.browse_uri_for_fq_path(r,s||"").toString();l.open_tab(a)},t}return r.__extends(t,e),t.prototype.renderSearchBar=function(){if(this.props.user){if(this.props.overrideSearchBar)return this.props.overrideSearchBar;if("legacy"===this.props.searchVariant)return s.default.createElement(u.SearchBarController,{user:this.props.user,currentPath:this.props.currentPath,isExpanded:this.props.isSearchBarExpanded,onSearch:this.props.onSearch||this.onSearch,onSearchResultOpen:this.props.onSearchResultOpen||this.logSearchResultOpen,onSlimSearchResultOpen:this.props.onSearchResultOpen?void 0:this.onSlimSearchResultOpen,onResultObjectPathClick:this.props.onResultObjectPathClick||this.onResultObjectPathClick,searchBarExperiments:this.props.searchBarExperiments||{},onSearchFiltersChanged:this.props.onSearchFiltersChanged||a.noop,fileCategories:this.props.fileCategories||m.FILE_CATEGORIES_UNCHECKED,searchFrom:this.props.searchFrom});if("full-page"===this.props.searchVariant||"dropdown"===this.props.searchVariant)return s.default.createElement(g.SearchInput,{variant:this.props.searchVariant,user:this.props.user,path:this.props.currentPath,isActive:!!this.props.isSearching,onSearchEnter:this.props.onSearchEnter,onSearchExit:this.props.onSearchExit,inputBoxRef:this.props.inputBoxRef})}return null},t.prototype.renderRightContent=function(){return this.props.rightContent?this.props.rightContent:s.default.createElement("div",{className:"top-menu-container--search-bar-empty-space"})},t.prototype.render=function(){return s.default.createElement("div",{className:"top-menu-container "+this.props.classNames},this.renderSearchBar(),this.renderRightContent())},t.defaultProps={searchVariant:"legacy",isSearchBarExpanded:!1,classNames:"",currentPath:"/"},t})(s.default.Component);t.TopMenuContainer=f.requireCssWithComponent(S,["/static/css/pagelet-vflVkuuMY.css"],[u.SearchBarController])})),define("modules/clean/react/maestro/components/header_portal",["require","exports","tslib","classnames","react","react-dom","modules/clean/react/css","modules/core/browser"],(function(e,t,r,s,a,o,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),o=r.__importDefault(o);var c;(function(e){e.TITLE="maestro-title-portal",e.SEARCH="maestro-search-portal",e.PROMPT="maestro-prompt-portal",e.TOP_MENU="maestro-top-menu-portal",e.NAV="maestro-nav-portal",e.CONTENT="maestro-content-portal"})(c=t.MaestroPortalElement||(t.MaestroPortalElement={}));var l=["h","recents","home","work","personal","search/personal","search/work"];function u(e){return void 0===e&&(e=i.get_pathname()),Boolean(l.find((function(t){return e==="/"+t||0===e.indexOf("/"+t+"/")})))}t.doesRouteSupportPortals=u;var p=(function(e){function t(t){var r=e.call(this,t)||this;if("function"==typeof(null===document||void 0===document?void 0:document.getElementById)){var s=document.getElementById("maestro-portal");if(!s){(s=document.createElement("div")).setAttribute("id","maestro-portal"),s.setAttribute("class","maestro-portal");var a=document.createElement("div");a.setAttribute("id",c.PROMPT),a.setAttribute("class",c.PROMPT),s.appendChild(a);var o=document.createElement("div");o.setAttribute("id",c.NAV),o.setAttribute("class",c.NAV),s.appendChild(o);var n=document.createElement("div");n.setAttribute("id",c.TITLE),n.setAttribute("class",c.TITLE),s.appendChild(n);var i=document.createElement("div");i.setAttribute("id",c.SEARCH),i.setAttribute("class",c.SEARCH),s.appendChild(i);var l=document.createElement("div");l.setAttribute("id",c.TOP_MENU),l.setAttribute("class",c.TOP_MENU),s.appendChild(l);var u=document.createElement("div");u.setAttribute("id",c.CONTENT),u.setAttribute("class",c.CONTENT),s.appendChild(u),document.body.insertBefore(s,document.body.firstChild)}r.elementPortalEl=document.getElementById(t.element)}return r}return r.__extends(t,e),t.prototype.render=function(){if(this.elementPortalEl){var e=this.props.element;return a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:s.default(e+"__shadow")}),o.default.createPortal(a.default.createElement("div",{className:this.props.chromeClass},this.props.children),this.elementPortalEl))}return null},t})(a.default.Component),h=n.requireCssWithComponent(p,["/static/css/maestro-nav/maestro-portal-vflZ9RW8r.css"]),d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return"ON"===this.props.maestroPortalExperiment&&u()?a.default.createElement(h,r.__assign({},this.props)):this.props.children},t})(a.default.PureComponent);t.MaestroPortal=d})),define("modules/clean/search/api_helpers",["require","exports","modules/clean/react/browse/models","modules/core/exception","modules/clean/search/types","modules/clean/filetypes","modules/clean/react/browse/constants"],(function(e,t,r,s,a,o,n){"use strict";function i(e){return new Date(e).getTime()/1e3}function c(e,t,s){var a,o,n=e.match_type?e.match_type[".tag"]:null,c=h(e.file_type),l=e.highlight_spans?e.highlight_spans:void 0,u=e.metadata.metadata,p=e.internal_metadata,d=e.snippets,_="folder"===u[".tag"],m=null;"folder"===u[".tag"]&&u.sharing_info&&!u.sharing_info.no_access&&(m=u.sharing_info.traverse_only?["can_view"]:u.sharing_info.read_only?["can_view","can_view_members"]:["can_edit","can_view","can_view_members"]);var f,g,S,y="deleted"!==u[".tag"]&&(null===(a=u.sharing_info)||void 0===a?void 0:a.is_parent_shared_folder_read_only),E="deleted"!==u[".tag"]?u.icon:"",v="deleted"!==u[".tag"]?u.id:"",R="deleted"!==u[".tag"]?u.per_node_metadata:void 0,C=u.client_modified?i(u.client_modified):0,b=0,w=u.path_display||"",P=!w,I="",T=!1,A=!1,x=!1,O=!1;if("file"===u[".tag"]){b=u.size,I=u.rev,T=!!u.cloud_doc_info,f=null===(o=u.cloud_doc_info)||void 0===o?void 0:o.open_url,A=!!u.is_in_vault_folder;var M=u.file_lock_info?u.file_lock_info:void 0;S=(null==M?void 0:M.created)?i(null==M?void 0:M.created):void 0,x=!!M,g=M?{is_lockholder:!!(null==M?void 0:M.is_lockholder),lockholder_name:null==M?void 0:M.lockholder_name,ts_locked:S}:void 0,O=!!u.symlink_info}"deleted"===u[".tag"]&&(b=-1);var B=0;p.is_shared_file&&(B=Math.floor(Math.random()*Math.floor(1e11)));var H=p.last_action_by_user_ts?i(p.last_action_by_user_ts):null,L=p.ns_id,F=p.ns_path,D=p.sjid,N=p.url;return{highlight_spans:l,match_type:n,snippets:d,last_action_by_user_ts:H,direct_blockserver_link:"",is_in_team_folder_tree:p.is_in_team_folder_tree,ns_id:L,ns_path:F,sjid:D,thumbnail_url_tmpl:p.thumbnail_url,href:N,last_modified_name:p.modified_by,ext:r.File.getExtensionFromPathForServerObject(_,w),is_dir:_,fq_path:w,bytes:b,type:c,mount_access_perms:m,read_only:y,is_cloud_doc:T,open_to_url:f,is_in_vault_folder:A,lock_info:g,is_locked:x,per_node_metadata:R,is_lockholder:!!(null==g?void 0:g.is_lockholder),lockholder_name:null==g?void 0:g.lockholder_name,ts_locked:S,sort_key:t.toString(),sort_rank:t,event_type:0,file_id:v,icon:E,is_symlink:O,is_unmounted:P,is_versionable:!0,revision_id:I,target_ns:B,request_id:s,ts:C}}function l(e,t,a){var o=e.match_type?e.match_type[".tag"]:null,n=h(e.file_type),c=e.highlight_spans?e.highlight_spans:[],l=e.metadata.metadata,u=e.internal_metadata,p=e.snippets;if(s.assert("file"===l[".tag"],"Search result metadata should be FileMetadataReference for FileSharedWithMe",{tags:["search"]}),"file"!==l[".tag"])throw Error("Search result metadata should be FileMetadataReference for FileSharedWithMe");var d=l.name,_=i(l.client_modified),m=l.icon,f=l.size,g=l.id,S=i(l.server_modified),y=!!l.cloud_doc_info,E=u.last_action_by_user_ts?i(u.last_action_by_user_ts):null,v=u.url,R=u.thumbnail_url;return{bytes:f,ext:r.File.getExtensionFromPathForServerObject(!1,d||""),file_id:g,filename:d,highlight_spans:c,href:v,icon:m,is_cloud_doc:y,last_modified_name:u.modified_by,match_type:o,request_id:a,server_timestamp:S,sort_rank:t,snippets:p,thumbnail_url_tmpl:R,ts:_,type:n,last_action_by_user_ts:E}}function u(e,t,r){var a=e.highlight_spans?e.highlight_spans:[],o=e.metadata.metadata,n=e.internal_metadata,i=e.snippets;if(s.assert("file"===o[".tag"],"Search result metadata should be FileMetadataReference for legacy Paper",{tags:["search"]}),"file"!==o[".tag"])throw Error("Search result metadata should be FileMetadataReference for legacy Paper");var c=o.name,l=o.id,u=o.client_modified,p=n.modified_by;return{title:c,pad_id:l,url:n.url,title_highlights:[],highlight_spans:a,last_editor_name:p,request_id:r,snippets:i,sort_rank:t,last_modified_date:u,ts:u}}function p(e){var t=e.metadata.metadata,r=e.internal_metadata,s=a.SearchResultTypes.FILE;return r.is_shared_file?s=a.SearchResultTypes.FILE_SHARED_WITH_ME:"file"===t[".tag"]&&"000000000"===t.rev&&(s=a.SearchResultTypes.PAPER),s}function h(e){return void 0===e?0:o.FileTypeMap.get(e[".tag"])||0}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTimezoneOffset=function(){return(new Date).getTimezoneOffset()},t.convertRequestDataToV2=function(e){var t,r,s;e.order_by===n.SEARCH_ORDER_BY_TYPE.RELEVANCE?r={".tag":"relevance"}:e.order_by===n.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME&&(r={".tag":"last_modified_time"}),e.reverse_order&&(s=e.reverse_order===n.SEARCH_REVERSE_ORDER_TYPE.TRUE);var o,i=[];return null===(t=e.file_categories)||void 0===t||t.split(",").forEach((function(e){e===a.FileCategory.OTHER?i.push({".tag":"others"}):i.push({".tag":e})})),e.deleted&&(o={".tag":"deleted"}),{query:e.query,options:{path:e.fq_path,max_results:e.max_results,filename_only:e.filename_only,file_categories:i.length>0?i:void 0,account_id:e.user_filter_account_id,image_content_search:e.is_image_content_search,order_by:r,reverse_order:s,file_status:o},match_field_options:{include_highlights:!0,include_snippets:!!e.include_snippets},session_id:e.search_session_id}},t.extractSearchV2ResultsList=function(e,t,o){for(var n=[],i=t,h=0,d=e;h<d.length;h++){var _=d[h];switch(s.assert("other"!==_.metadata[".tag"],"Search result metadata should not be MetadataV2Other type",{tags:["search"]}),p(_)){case a.SearchResultTypes.FILE:n.push(r.File.fromServerObject(c(_,i,o)));break;case a.SearchResultTypes.FILE_SHARED_WITH_ME:n.push(r.FileSharedWithMe.fromServerObject(l(_,i,o)));break;case a.SearchResultTypes.PAPER:n.push(r.Paper.fromServerObject(u(_,i,o)))}i++}return n},t.extractSearchResultsList=function(e,t){for(var s=[],o=t,n=0,i=e;n<i.length;n++){var c=i[n];switch(c.sort_rank=o,c.sort_key=o.toString(),c.search_result_type){case a.SearchResultTypes.FILE:s.push(r.File.fromServerObject(c));break;case a.SearchResultTypes.FILE_SHARED_WITH_ME:s.push(r.FileSharedWithMe.fromServerObject(c));break;case a.SearchResultTypes.PAPER:s.push(r.Paper.fromServerObject(c));break;case a.SearchResultTypes.PAPER_FOLDER:s.push(r.PaperFolder.fromServerObject(c))}o++}return s}})),define("modules/clean/react/retrieval_success_banner/util",["require","exports","tslib","modules/clean/filepath","modules/clean/history","modules/clean/storage","modules/clean/react/retrieval_success_banner/constants","modules/clean/web_timing_logger"],(function(e,t,r,s,a,o,n,i){"use strict";var c,l;function u(){return c&&l?Promise.resolve({store:c,actionCreators:l}):i.waitForTTI().then((function(){return Promise.all([new Promise((function(t,r){e(["modules/clean/react/retrieval_success_banner/data/store"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/react/retrieval_success_banner/data/action_creators"],t,r)})).then(r.__importStar)]).then((function(e){var t=e[0],r=e[1];return{store:c=t.getStoreForSuccessBanner(),actionCreators:l=r}}))}))}function p(e){void 0===e&&(e=!0),e&&m()||(o.LocalStorage.set(n.SEARCH_SUCCESS_SHOW_BANNER_KEY,e),u().then((function(t){var r=t.store,s=t.actionCreators.updateSearchSuccessBannerVisibility;r.dispatch(s(e))})))}function h(){o.LocalStorage.set(n.SEARCH_RESULT_CLICK_TIMESTAMP_KEY,Date.now())}function d(e){o.LocalStorage.set(n.SEARCH_RESULT_PATH_KEY,e)}function _(){return!!o.LocalStorage.get(n.SEARCH_RESULT_CLICK_KEY)}function m(){return!!o.LocalStorage.get(n.SEARCH_SUCCESS_OPT_OUT_KEY)}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),a=r.__importDefault(a),t.resetSearchResultClickKey=function(){o.LocalStorage.delete(n.SEARCH_RESULT_CLICK_KEY)},t.shouldShowSearchSuccessBanner=function(){return!!o.LocalStorage.get(n.SEARCH_SUCCESS_SHOW_BANNER_KEY)},t.getSearchSuccessBannerVisibility=function(){return!!o.LocalStorage.get(n.SEARCH_SUCCESS_SHOW_BANNER_KEY)&&!o.LocalStorage.get(n.SEARCH_SUCCESS_OPT_OUT_KEY)},t.setSearchSuccessBannerVisible=p,t.setSearchResultClickTimestamp=h,t.getSearchResultClickTimestamp=function(){return o.LocalStorage.get(n.SEARCH_RESULT_CLICK_TIMESTAMP_KEY)},t.getClickableFilePathClickTimestamp=function(){return o.LocalStorage.get(n.CLICKABLE_FILE_PATH_CLICK_TIMESTAMP_KEY)},t.setSearchResultPath=d,t.setFolderSearchResultData=function(e){m()||(h(),d(e))},t.setClickablePathData=function(e){m()||(o.LocalStorage.set(n.CLICKABLE_FILE_PATH_CLICK_TIMESTAMP_KEY,Date.now()),(function(e){o.LocalStorage.set(n.CLICKABLE_PATH_KEY,e)})(e))},t.getSearchResultPath=function(){return o.LocalStorage.get(n.SEARCH_RESULT_PATH_KEY)},t.getClickablePath=function(){return o.LocalStorage.get(n.CLICKABLE_PATH_KEY)},t.setClickedOnSearchResultsPageItem=function(){m()||o.LocalStorage.set(n.SEARCH_RESULT_CLICK_KEY,!0)},t.getClickedOnSearchResultsPageItem=_,t.userIsOptedOutOfRetrievalSuccessBanner=m,t.optOutOfSearchSuccessBanner=function(){o.LocalStorage.set(n.SEARCH_SUCCESS_OPT_OUT_KEY,!0)},t.setSearchSuccessBannerVisibleFromHome=function(){o.LocalStorage.set(n.SEARCH_SUCCESS_SHOW_BANNER_FROM_HOME_KEY,!0)},t.getSearchSuccessBannerVisibleFromHome=function(){return!!o.LocalStorage.get(n.SEARCH_SUCCESS_SHOW_BANNER_FROM_HOME_KEY)},t.resetSearchSuccessBannerVisibleFromHome=function(){o.LocalStorage.delete(n.SEARCH_SUCCESS_SHOW_BANNER_FROM_HOME_KEY)},t.parentPathOfFileEqualsSearchResultPath=function(e,t,r){return s.parent_dir(e)===t&&!r},t.doSearchBarInteractionBroadcast=function(e){u().then((function(t){var r=t.store,s=t.actionCreators.updateSearchBarAbandoned;r.dispatch(s(e))}))},t.doSearchResultBannerDismissBroadcast=function(e){u().then((function(t){var r=t.store,s=t.actionCreators.updateSearchResultBannerDismissed;r.dispatch(s(e))}))},t.doSearchResultActionClickBroadcast=function(e){m()||u().then((function(t){var r=t.store,s=t.actionCreators.updateSearchResultActionClicked;r.dispatch(s(e))}))},t.setupSearchSuccessBannerForHome=function(){a.default.deconstruct_url(document.referrer).qargs.search_session_id&&!_()&&p()},t.isFilePreview=function(){return!!a.default.deconstruct_url().qargs.hasOwnProperty("preview")},t.updateRSBVisibility=function(e){e?u().then((function(e){var t=e.store,r=e.actionCreators.updateRetrievalSuccessBannerVisibility;t.dispatch(r(!0))})):u().then((function(e){var t=e.store,r=e.actionCreators.updateRetrievalSuccessBannerVisibility;t.dispatch(r(!1))}))}}));
//# sourceMappingURL=pkg-embedded_app_search.min.js-vflzj0xnO.map