define(["require","exports","tslib","classnames","dig-components/buttons","dig-components/menu","modules/clean/file_store/utils","modules/clean/integrations/data/selectors","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/shared_file_popover_content_component","modules/clean/react/app_actions/telemetry_client","modules/clean/react/css","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/types","modules/clean/react/extensions/extensions_popover_content_component_v2","modules/clean/react/extensions/extensions_utils","modules/clean/react/extensions/file","modules/clean/react/extensions/tooltips","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer/unity/with_unity","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/constants/file_viewer","modules/core/i18n","react","react-redux","spectrum/button","spectrum/tertiary_link","spectrum/tooltip"],(function(e,t,n,o,r,i,a,s,l,p,c,u,d,g,f,m,_,h,T,y,v,w,C,E,S,x,B,O,b,A,P,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),O=n.__importDefault(O);var D="TOOLTIP_ONLY"===x.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,I="COPY_AND_TOOLTIP"===x.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,F=(function(e){function t(t){var o=e.call(this,t)||this;return o.openOptionsArgs=function(){var e=o.props.telemetryContext,t=e?e.surface:void 0;return n.__assign(n.__assign({},o.props),{isCloudEditorDisabled:!0,surface:t})},o.handleButtonClick=function(e){e.preventDefault(),e.stopPropagation()},o.handleMenuClick=function(e){e.preventDefault(),e.stopPropagation()},o.handleHover=function(){o.currentSession&&o.currentSession.event("trigger_hover")},o.setBigTooltip=function(e){return n.__awaiter(o,void 0,void 0,(function(){var t,o,r,i,a,s,p,c,u;return n.__generator(this,(function(n){switch(n.label){case 0:return t=this.props,o=t.file,r=t.appActions,i=t.featureFlags,a=T.getFileExt(o)||"",(s=r.length>0)?[4,l.getTooltipHistory(e,["open_with_edu"])]:[3,2];case 1:p=n.sent(),c=y.allowedTooltips(s,a,i),u=c.find((function(e){return void 0!==p[e]&&!p[e]})),this.setState({bigTooltipName:u}),n.label=2;case 2:return[2]}}))}))},o.markBigTooltipViewed=function(){var e=!1,t=[];o.state.bigTooltipName&&(t.push(l.markTooltipViewed(o.props.user.id,o.state.bigTooltipName)),e=!0),e&&(Promise.all(t).then((function(){o.props.showBigTooltip&&o.setBigTooltip(o.props.user.id)})),o.setState({bigTooltipName:void 0}))},o.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),o.props.onExtensionClick&&o.props.onExtensionClick(e.actionName||e.userAction),o.logToPreviews(e,!1),t.stopPropagation()},o.logToPreviews=function(e,t){if(o.props.telemetryContext&&"previews"===o.props.telemetryContext.surface&&e.userAction){var n=t?v.UserActionContext.TitleBarMain:v.UserActionContext.TitleBarSplitButton,r=e.actionName?{app_action_name:e.actionName}:{};a.isBrowseFile(o.props.file)&&o.props.file.read_only&&(r.readOnly=!0),w.logUserAction(e.userAction,n,r)}},o.renderTrigger=function(e){var t=null;switch(o.props.triggerType){case m.TriggerType.SidebarLink:t=O.default.createElement(P.TertiaryLink,n.__assign({className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-link",icon:"open-with"},e),o.triggerText());break;case m.TriggerType.OpacityButton:t=O.default.createElement(r.Button,n.__assign({variant:"opacity",className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-button"},e),o.renderTriggerButtonContent());break;default:t=O.default.createElement(A.Button,n.__assign({className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-button",variant:o.props.triggerType===m.TriggerType.SecondaryButton||o.props.triggerType===m.TriggerType.CollapsedButton?"secondary":"primary"},e),o.renderTriggerButtonContent())}return O.default.createElement("div",n.__assign({onMouseDown:o.markBigTooltipViewed,onMouseEnter:o.handleHover},e),t)},o.renderExtensionPopoverV2Content=function(e){return function(){var t=o.props,n=t.file,r=t.user,i=t.appActions,s=t.bylines,l=t.categoryInfos,c=t.featureFlags,u=t.telemetryContext,d=h.getCategoryIdToInfos(l);if(a.isBrowseFile(n)&&(i.length>0||e.length>0))return O.default.createElement(_.ExtensionsPopoverV2WithUnity,{file:n,user:r,openOptions:e,appActions:i,bylines:s,categoryIdToInfos:d,featureFlags:c,updateLinkState:o.handleUpdateLinkState,telemetryContext:u,currentSession:o.currentSession});if(a.isSharedFile(n)){var f=g.partitionActions(i).cloudEditors;return O.default.createElement(p.SharedFilePopoverContent,{openOptions:e,cloudEditorAppActions:f,file:n,user:r,currentSession:o.currentSession})}return null}},o.renderMenu=function(e){return O.default.createElement(i.Menu.Wrapper,{className:"app-actions__unportaled-menu",onSelection:o.handleSelectAction,onToggle:o.onPopoverToggle,isPortaled:!0},(function(t){var r=t.getContentProps,a=t.getTriggerProps;return O.default.createElement(O.default.Fragment,null,o.renderTrigger(a({onClick:o.handleButtonClick})),O.default.createElement(i.Menu.Content,n.__assign({},r({}),{onClick:o.handleMenuClick,className:"app-actions-open-with-menu",placement:"bottom-end"}),o.renderExtensionPopoverV2Content(e)()))}))},o.onPopoverToggle=function(e){var t=e.isOpen;t&&o.props.onDropdownOpen?o.props.onDropdownOpen():!t&&o.props.onDropdownClose&&o.props.onDropdownClose(),o.currentSession&&o.currentSession.event(t?"open_popover":"close_popover")},o.onDownloadClick=function(e){return function(t){t.preventDefault(),t.stopPropagation(),e.handler(),o.logToPreviews(e,!0)}},o.handleUpdateLinkState=function(e,t){var n=o.props.updateLinkState;n&&n({actionId:e,linkState:t})},o.state={},o.telemetryClient=c.createTelemetryClient({component:"menu_v2"}),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.showBigTooltip&&this.setBigTooltip(this.props.user.id)},t.prototype.triggerText=function(){return B.intl.formatMessage({id:"z5t3Bh",defaultMessage:"Open"})},t.prototype.renderTriggerButtonContent=function(){var e=this.triggerText();if(this.props.triggerType===m.TriggerType.CollapsedButton){var t=O.default.createElement("div",{className:"app-actions-open-with-menu__trigger-content"},O.default.createElement(S.ButtonIcon,{name:"open","aria-label":e}));return(D||I)&&this.props.triggerType===m.TriggerType.CollapsedButton?O.default.createElement(k.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:B.intl.formatMessage({id:"KEegJt",defaultMessage:"Open With"})},t):t}return O.default.createElement("div",{className:"app-actions-open-with-menu__trigger-content app-actions-open-with-menu__trigger-content--with-text"},O.default.createElement("div",{className:"app-action-open-with-menu__trigger-button-text"},e+" â–¾"))},t.prototype.render=function(){var e=this.props,t=e.file,n=e.appActions,r=e.featureFlags,i=e.isInFVSidebar,s=e.telemetryContext,l=e.triggerType,p=e.showAsButtonIfDownloadOnly;if(!t.file_id)return null;s?this.currentSession=this.telemetryClient.session({surface:s.surface,ext:c.getPiiSafeExtension(T.getFileExt(t)||""),feature_flags:r}):delete this.currentSession;var u=h.getOpenOptionsForFile(this.openOptionsArgs()),d=l===m.TriggerType.CollapsedButton,f=u.length>0,_=!1;if(f&&1===u.length&&(f=!(_=u[0].type===C.OpenButtonAction.DOWNLOAD)),!f&&(0===n.length||a.isSharedFile(t)&&0===g.partitionActions(n).cloudEditors.length)){if(p&&_){var y=l===m.TriggerType.SecondaryButton||d?"secondary":"primary",v=d||i&&"secondary"===y;return O.default.createElement(A.Button,{className:o.default("app-actions-download-button",{"app-actions-download-button--collapsed":v}),variant:y,onClick:this.onDownloadClick(u[0])},v?O.default.createElement(S.ButtonIcon,{name:"download-file",isPrimary:"primary"===y,"aria-label":B.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"})}):B.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"}))}return null}return this.renderMenu(u)},t.defaultProps={showAsButtonIfDownloadOnly:!1,triggerType:m.TriggerType.SecondaryButton},t})(O.default.Component);t.ExtensionsMenuV2Component=F;var M=function(e,t){return{appActions:f.getOpenActionsForFile(e,t.file),bylines:f.getBylines(e),categoryInfos:f.getCategoryInfos(e),featureFlags:f.getFeatureFlags(e),cloudDocsInfo:f.getCloudDocInfo(e),landingPagesEnabled:s.isConnectServiceLandingPagesEnabled(e)}},N={updateLinkState:d.updateLinkState,refreshSharingServiceInfo:d.refreshSharingServiceInfoAdapter},L=b.connect(M,N)(F);t.ExtensionsMenuV2NoUnity=u.requireCssWithComponent(L,["/static/css/app_actions/index-vflM3ESn8.css","/static/css/dig-components/index.web-vflyKkT3N.css"]);var V=b.connect(M,N)((function(e){return a.isBrowseFile(e.file)?O.default.createElement(E.WithUnity,{file:e.file,user:e.user,render:function(t){return O.default.createElement(F,n.__assign({},e,{unityInfo:t}))}}):O.default.createElement(F,n.__assign({},e))}));t.ExtensionsMenuV2=u.requireCssWithComponent(V,["/static/css/app_actions/index-vflM3ESn8.css","/static/css/dig-components/index.web-vflyKkT3N.css"])}));
//# sourceMappingURL=extensions_menu_component_v2.min.js-vflN112bn.map